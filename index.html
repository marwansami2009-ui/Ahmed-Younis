<!DOCTYPE html>
<html dir="rtl" lang="ar">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ù„Ù…Ù†ØµØ© Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠØ© | Ø£Ø³ØªØ§Ø° Ø£Ø­Ù…Ø¯ Ø³Ø¹Ø¯ ÙŠÙˆÙ†Ø³</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getDatabase, ref, set, get, child, push, update, onValue, remove, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";
        import { getAuth, signInWithPopup, GoogleAuthProvider, signOut, onAuthStateChanged, signInWithPhoneNumber, RecaptchaVerifier } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
        
        const firebaseConfig = {
            apiKey: 'AIzaSyDZ9y1XLS0wMR0kKdEOO91utF7-5p9vp_M',
            authDomain: 'sabeel-platform-official.firebaseapp.com',
            projectId: 'sabeel-platform-official',
            storageBucket: 'sabeel-platform-official.firebasestorage.app',
            messagingSenderId: '150583731393',
            appId: '1:150583731393:web:8c181e212832356af2e040',
            measurementId: 'G-65HE8PB0XT',
            databaseURL: 'https://sabeel-platform-official-default-rtdb.asia-southeast1.firebasedatabase.app'
        };
        
        const app = initializeApp(firebaseConfig);
        window.db = getDatabase(app);
        window.auth = getAuth(app);
        window.googleProvider = new GoogleAuthProvider();
        window.rtdb = { ref, set, get, child, push, update, onValue, remove, serverTimestamp };
        window.authMethods = { signInWithPopup, GoogleAuthProvider, signOut, onAuthStateChanged, signInWithPhoneNumber, RecaptchaVerifier };
    </script>

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        brand: {
                            dark: '#1a1a1a',
                            card: '#2a2a2a',
                            primary: '#8b0000',
                            accent: '#d4af37',
                        }
                    },
                    fontFamily: { 'cairo': ['Cairo', 'sans-serif'] },
                    animation: {
                        'float': 'float 6s ease-in-out infinite',
                        'slide-up': 'slideUp 0.8s ease-out',
                    },
                    keyframes: {
                        float: { '0%, 100%': { transform: 'translateY(0)' }, '50%': { transform: 'translateY(-20px)' } },
                        slideUp: { '0%': { transform: 'translateY(30px)', opacity: '0' }, '100%': { transform: 'translateY(0)', opacity: '1' } },
                    }
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;900&display=swap');

        :root {
            --primary-red: #8b0000;
            --dark-bg: #1a1a1a;
            --success-green: #2e7d32;
            --gold-accent: #d4af37;
        }

        * {
            box-sizing: border-box;
        }

        body {
            font-family: 'Cairo', sans-serif;
            background-color: var(--dark-bg);
            color: #fff;
            overflow-x: hidden;
            margin: 0;
        }

        .glass-panel {
            background: rgba(42, 42, 42, 0.95);
            backdrop-filter: blur(16px);
            border: 1px solid rgba(212, 175, 55, 0.2);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.5);
            border-radius: 16px;
        }

        .glass-icon {
            background: linear-gradient(135deg, rgba(212, 175, 55, 0.25) 0%, rgba(139, 0, 0, 0.15) 100%);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(212, 175, 55, 0.3);
            border-radius: 12px;
            padding: 10px;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: var(--primary-red);
            color: white;
            font-weight: 800;
            transition: all 0.3s ease;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(139, 0, 0, 0.4);
        }

        .btn-gold {
            background: var(--gold-accent);
            color: var(--dark-bg);
            font-weight: 800;
        }

        .grade-badge-1sec { background: rgba(139, 0, 0, 0.2); color: #ff6b6b; border: 1px solid rgba(139, 0, 0, 0.3); }
        .grade-badge-2sec { background: rgba(46, 125, 50, 0.2); color: #81c784; border: 1px solid rgba(46, 125, 50, 0.3); }
        .grade-badge-3sec { background: rgba(212, 175, 55, 0.2); color: #ffd966; border: 1px solid rgba(212, 175, 55, 0.3); }

        .locked-overlay {
            position: absolute;
            inset: 0;
            background: rgba(26, 26, 26, 0.9);
            backdrop-filter: blur(4px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10;
        }

        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--dark-bg);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--primary-red);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--gold-accent);
        }
    </style>
</head>

<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // ================ Ø§Ù„Ø«ÙˆØ§Ø¨Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© ================
        const SUPER_ADMIN_EMAIL = 'marwansami2009@gmail.com';
        const SUPER_ADMIN_UID = 'O3NqanKElfVqOpilTTl4lME9m1q2';
        const ADMIN_SECRET_PASSWORD = '123456789';
        const MANAGER_PASSWORD = '01023456789';

        const CONTACT_INFO = {
            whatsapp: 'https://wa.me/201000000000',
            facebook: 'https://facebook.com/yourpage',
            youtube: 'https://youtube.com/yourchannel',
            telegram: 'https://t.me/yourchannel',
            vodafoneNumber: '010xxxxxxxx',
            supportWhatsapp: 'https://wa.me/201000000000'
        };

        // ================ Ø§Ù„ØªØºÙŠÙŠØ± Ø§Ù„Ù…Ø·Ù„ÙˆØ¨: ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù†ØµØ© ================
        const PLATFORM_NAME = 'Ø§Ù„Ù…Ù†ØµØ© Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠØ©';
        const PLATFORM_SHORT = 'Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠØ©';
        const TEACHER_NAME = 'Ø£Ø³ØªØ§Ø° Ø£Ø­Ù…Ø¯ Ø³Ø¹Ø¯ ÙŠÙˆÙ†Ø³';
        const TEACHER_TITLE = 'Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠ';
        const SUBJECT_NAME = 'Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©';

        // ================ Ø£ÙŠÙ‚ÙˆÙ†Ø© Lucide ================
        const Icon = ({ name, size = 20, className = '' }) => {
            useEffect(() => { if (window.lucide) window.lucide.createIcons(); });
            return <i data-lucide={name} style={{ width: size, height: size }} className={className}></i>;
        };

        const GlassIcon = ({ name, size = 24, className = '' }) => (
            <div className={`glass-icon inline-flex items-center justify-center ${className}`}>
                <Icon name={name} size={size} />
            </div>
        );

        // ================ Ø¯Ø§Ù„Ø© Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø© ================
        const isLectureAllowed = (user, lecture, enrolledCourses) => {
            if (!user || !lecture) return false;
            
            // Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª Ø§Ù„Ù…Ø¬Ø§Ù†ÙŠØ© ØªØ¸Ù‡Ø± Ù„Ù„ÙƒÙ„
            if (lecture.isFree) return true;
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù† Ø§Ù„Ø·Ø§Ù„Ø¨ Ù…Ø´ØªØ±Ùƒ ÙÙŠ Ø§Ù„ÙƒÙˆØ±Ø³
            if (lecture.courseId && enrolledCourses && enrolledCourses.includes(lecture.courseId)) return true;
            
            return false;
        };

        // âœ… Phone Login Component
        const PhoneLoginModal = ({ onClose, onLoginSuccess }) => {
            const [phoneNumber, setPhoneNumber] = useState('');
            const [otp, setOtp] = useState('');
            const [step, setStep] = useState('phone');
            const [verificationId, setVerificationId] = useState(null);
            const [error, setError] = useState('');
            const [loading, setLoading] = useState(false);

            const setupRecaptcha = () => {
                if (!window.recaptchaVerifier) {
                    window.recaptchaVerifier = new window.authMethods.RecaptchaVerifier('recaptcha-container', {
                        'size': 'invisible',
                        'callback': () => { }
                    }, window.auth);
                }
            };

            const handleSendOtp = async () => {
                setLoading(true);
                setError('');
                try {
                    setupRecaptcha();
                    const formattedPhone = phoneNumber.startsWith('+20') ? phoneNumber : `+2${phoneNumber}`;
                    const confirmation = await window.authMethods.signInWithPhoneNumber(window.auth, formattedPhone, window.recaptchaVerifier);
                    setVerificationId(confirmation.verificationId);
                    setStep('otp');
                } catch (err) {
                    console.error("Phone auth error:", err);
                    setError('ÙØ´Ù„ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ù…Ø². ØªØ£ÙƒØ¯ Ù…Ù† Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ ÙˆØ­Ø§ÙˆÙ„ Ù…Ø¬Ø¯Ø¯Ø§Ù‹.');
                } finally {
                    setLoading(false);
                }
            };

            const handleVerifyOtp = async () => {
                setLoading(true);
                setError('');
                try {
                    const credential = window.auth.PhoneAuthProvider.credential(verificationId, otp);
                    const userCredential = await window.auth.signInWithCredential(credential);
                    onLoginSuccess(userCredential.user);
                    onClose();
                } catch (err) {
                    console.error("OTP verification error:", err);
                    setError('Ø§Ù„Ø±Ù…Ø² ØºÙŠØ± ØµØ­ÙŠØ­. Ø­Ø§ÙˆÙ„ Ù…Ø¬Ø¯Ø¯Ø§Ù‹.');
                } finally {
                    setLoading(false);
                }
            };

            return (
                <div className="fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-[100] p-4" onClick={onClose}>
                    <div className="glass-panel p-8 max-w-md w-full" onClick={e => e.stopPropagation()}>
                        <h2 className="text-2xl font-bold mb-6 text-center">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</h2>
                        <div id="recaptcha-container"></div>

                        {step === 'phone' && (
                            <>
                                <input
                                    type="tel"
                                    placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ (Ù…Ø«Ø§Ù„: 01001234567)"
                                    value={phoneNumber}
                                    onChange={(e) => setPhoneNumber(e.target.value.replace(/[^0-9]/g, ''))}
                                    className="w-full p-4 bg-white/5 border border-white/10 rounded-xl mb-4 outline-none text-center"
                                />
                                {error && <p className="text-red-400 text-sm mb-4 text-center">{error}</p>}
                                <button
                                    onClick={handleSendOtp}
                                    disabled={loading}
                                    className="btn-primary w-full py-4 rounded-xl font-bold flex items-center justify-center gap-2 disabled:opacity-50"
                                >
                                    {loading ? 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„...' : 'Ø¥Ø±Ø³Ø§Ù„ Ø±Ù…Ø² Ø§Ù„ØªØ­Ù‚Ù‚'}
                                    <Icon name="send" size={18} />
                                </button>
                            </>
                        )}

                        {step === 'otp' && (
                            <>
                                <input
                                    type="text"
                                    placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ù…ÙƒÙˆÙ† Ù…Ù† 6 Ø£Ø±Ù‚Ø§Ù…"
                                    value={otp}
                                    onChange={(e) => setOtp(e.target.value.replace(/[^0-9]/g, ''))}
                                    className="w-full p-4 bg-white/5 border border-white/10 rounded-xl mb-4 outline-none text-center tracking-widest"
                                />
                                {error && <p className="text-red-400 text-sm mb-4 text-center">{error}</p>}
                                <button
                                    onClick={handleVerifyOtp}
                                    disabled={loading}
                                    className="btn-primary w-full py-4 rounded-xl font-bold flex items-center justify-center gap-2 disabled:opacity-50"
                                >
                                    {loading ? 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚...' : 'ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø±Ù…Ø²'}
                                    <Icon name="check" size={18} />
                                </button>
                            </>
                        )}

                        <button onClick={onClose} className="mt-4 w-full py-3 bg-white/10 rounded-xl font-bold text-sm">
                            Ø¥Ù„ØºØ§Ø¡
                        </button>
                    </div>
                </div>
            );
        };

        // âœ… Auth Modal Component
        const AuthModal = ({ isOpen, onClose, onGoogleLogin, onPhoneLogin }) => {
            if (!isOpen) return null;
            return (
                <div className="fixed inset-0 bg-black/90 backdrop-blur-md z-[200] flex items-center justify-center p-4" onClick={onClose}>
                    <div className="glass-panel p-8 w-full max-w-md relative animate-slide-up border border-[#d4af37]/20" onClick={e => e.stopPropagation()}>
                        <button onClick={onClose} className="absolute top-4 left-4 p-2 hover:bg-white/10 rounded-full transition">
                            <Icon name="x" size={24} />
                        </button>

                        <div className="text-center mb-8">
                            <div className="w-16 h-16 bg-[#d4af37]/10 rounded-full flex items-center justify-center mx-auto mb-4 border border-[#d4af37]/30">
                                <span className="text-4xl text-[#d4af37]">â™</span>
                            </div>
                            <h2 className="text-2xl font-bold mb-2">Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙÙŠ {PLATFORM_NAME}</h2>
                            <p className="text-slate-400 text-sm">Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„Ùƒ Ø§Ù„Ø¢Ù† ÙˆØ§Ø¨Ø¯Ø£ Ø±Ø­Ù„Ø© Ø§Ù„ØªØ¹Ù„Ù…</p>
                        </div>

                        <div className="space-y-4">
                            <button onClick={onGoogleLogin} className="w-full bg-white text-black p-4 rounded-xl font-bold flex items-center justify-center gap-3 hover:scale-[1.02] transition shadow-lg">
                                <img src="https://www.svgrepo.com/show/475656/google-color.svg" className="w-6 h-6" alt="Google" />
                                ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Google
                            </button>

                            <div className="relative my-6 text-center">
                                <div className="absolute inset-0 flex items-center"><div className="w-full border-t border-white/10"></div></div>
                                <span className="relative bg-[#2a2a2a] px-4 text-xs text-slate-500">Ø£Ùˆ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù‡Ø§ØªÙ</span>
                            </div>

                            <button onClick={onPhoneLogin}
                                className="w-full bg-white/5 border border-white/10 text-white p-4 rounded-xl font-bold flex items-center justify-center gap-3 hover:bg-white/10 transition">
                                <Icon name="smartphone" size={20} className="text-[#d4af37]" />
                                Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        // ğŸ† Rank Badge Component
        const RankBadge = ({ points }) => {
            let rank, rankClass;
            if (points >= 200) { rank = 'Ø£Ø³Ø·ÙˆØ±ÙŠ'; rankClass = 'bg-gradient-to-r from-[#d4af37] to-[#b8860b] text-[#1a1a1a]'; }
            else if (points >= 51) { rank = 'Ù…ØªÙ‚Ø¯Ù…'; rankClass = 'bg-gradient-to-r from-[#8b0000] to-[#660000] text-white'; }
            else { rank = 'Ù…Ø¨ØªØ¯Ø¦'; rankClass = 'bg-gradient-to-r from-gray-600 to-gray-700 text-white'; }
            return (
                <span className={`${rankClass} px-3 py-1 rounded-full text-xs font-bold`}>
                    {rank}
                </span>
            );
        };

        // ğŸ”’ Locked Content Overlay
        const LockedOverlay = ({ message = 'Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ù…ØºÙ„Ù‚' }) => (
            <div className="absolute inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center z-10 rounded-xl">
                <div className="text-center">
                    <div className="glass-icon mx-auto mb-2"><Icon name="lock" size={32} className="text-[#d4af37]" /></div>
                    <p className="font-bold">{message}</p>
                </div>
            </div>
        );

        // âœ… Course Purchase Modal
        const CoursePurchaseModal = ({ course, onClose, teacherNumber, user, onRequireLogin }) => {
            const [step, setStep] = useState(1);

            if (!course) return null;

            const handleSubscribeClick = () => {
                if (!user) {
                    onRequireLogin();
                } else {
                    setStep(2);
                }
            };

            return (
                <div className="fixed inset-0 bg-black/95 z-[300] flex items-center justify-center p-4 backdrop-blur-sm" onClick={onClose}>
                    <div className="glass-panel p-6 w-full max-w-lg relative animate-scale-in border border-[#d4af37]/20" onClick={e => e.stopPropagation()}>
                        <button onClick={onClose} className="absolute top-4 left-4 p-2 hover:bg-white/10 rounded-full"><Icon name="x" /></button>

                        {step === 1 && (
                            <div className="space-y-6">
                                <div className="h-48 rounded-xl overflow-hidden relative bg-[#8b0000]/20">
                                    {course.image ? (
                                        <img src={course.image} className="w-full h-full object-cover" />
                                    ) : (
                                        <div className="w-full h-full flex items-center justify-center text-[#d4af37] text-4xl">ğŸ“š</div>
                                    )}
                                    <div className="absolute inset-0 bg-gradient-to-t from-black/80 to-transparent flex items-end p-4">
                                        <h2 className="text-2xl font-bold text-white">{course.title}</h2>
                                    </div>
                                </div>
                                
                                <div className="space-y-4">
                                    <div className="bg-white/5 p-4 rounded-xl">
                                        <h3 className="font-bold text-[#d4af37] mb-2">Ù…Ù…ÙŠØ²Ø§Øª Ø§Ù„ÙƒÙˆØ±Ø³:</h3>
                                        <p className="text-slate-300 text-sm leading-relaxed whitespace-pre-wrap">{course.description}</p>
                                    </div>
                                    <div className="flex justify-between items-center text-sm font-bold">
                                        <span className={`px-2 py-1 rounded grade-badge-${course.grade}`}>
                                            {course.grade === '1sec' ? 'Ø£ÙˆÙ„Ù‰ Ø«Ø§Ù†ÙˆÙŠ' : course.grade === '2sec' ? 'ØªØ§Ù†ÙŠØ© Ø«Ø§Ù†ÙˆÙŠ' : 'ØªØ§Ù„ØªØ© Ø«Ø§Ù†ÙˆÙŠ'}
                                        </span>
                                        <span className="text-2xl text-[#2e7d32]">{course.price} Ø¬.Ù…</span>
                                    </div>
                                </div>
                                <button onClick={handleSubscribeClick} className="btn-primary w-full py-4 rounded-xl font-bold text-lg">Ø§Ø´ØªØ±Ùƒ Ø§Ù„Ø¢Ù†</button>
                            </div>
                        )}

                        {step === 2 && (
                            <div className="text-center space-y-8 py-8">
                                <div className="w-24 h-24 bg-yellow-500/20 text-yellow-500 rounded-full flex items-center justify-center mx-auto animate-pulse">
                                    <Icon name="alert-triangle" size={48} />
                                </div>
                                <div>
                                    <h3 className="text-2xl font-bold text-white mb-2">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±</h3>
                                    <p className="text-slate-300">Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø±ØºØ¨ØªÙƒ ÙÙŠ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ ÙÙŠ ÙƒÙˆØ±Ø³<br/><span className="text-[#d4af37] font-bold">"{course.title}"</span>ØŸ</p>
                                </div>
                                <div className="flex gap-4">
                                    <button onClick={() => setStep(1)} className="flex-1 py-3 bg-white/10 rounded-xl font-bold hover:bg-white/20">ØªØ±Ø§Ø¬Ø¹</button>
                                    <button onClick={() => setStep(3)} className="flex-1 py-3 bg-[#d4af37] text-[#1a1a1a] rounded-xl font-bold hover:scale-105 transition">Ù†Ø¹Ù…ØŒ Ù…ØªØ§Ø¨Ø¹Ø© Ù„Ù„Ø¯ÙØ¹</button>
                                </div>
                            </div>
                        )}

                        {step === 3 && (
                            <div className="space-y-6">
                                <div className="text-center border-b border-white/10 pb-4">
                                    <h3 className="text-xl font-bold text-green-400 mb-1">Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯ÙØ¹</h3>
                                    <p className="text-xs text-slate-400">Ø­ÙˆÙ„ Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ Ø«Ù… Ø£Ø±Ø³Ù„ ØµÙˆØ±Ø© Ø§Ù„Ø¥ÙŠØµØ§Ù„</p>
                                </div>
                                
                                <div className="bg-white/5 p-6 rounded-xl space-y-4">
                                    <div className="flex justify-between items-center">
                                        <span className="text-slate-400">Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø·Ù„ÙˆØ¨:</span>
                                        <span className="text-2xl font-black text-white">{course.price} Ø¬.Ù…</span>
                                    </div>
                                    <div className="flex justify-between items-center">
                                        <span className="text-slate-400">Ø±Ù‚Ù… ÙÙˆØ¯Ø§ÙÙˆÙ† ÙƒØ§Ø´:</span>
                                        <span className="text-xl font-mono font-bold text-[#d4af37] select-all">{teacherNumber}</span>
                                    </div>
                                    <div className="flex justify-between items-center">
                                        <span className="text-slate-400">ÙƒÙˆØ¯ Ø§Ù„Ø·Ø§Ù„Ø¨:</span>
                                        <span className="text-xl font-mono font-bold text-yellow-400 select-all">{user?.code || 'Ù„Ù… ÙŠØªÙ… ØªØ¹ÙŠÙŠÙ†Ù‡'}</span>
                                    </div>
                                </div>

                                <div className="bg-yellow-500/10 p-4 rounded-xl text-xs text-yellow-200 flex gap-2">
                                    <Icon name="info" size={16} className="shrink-0" />
                                    <p>Ø¨Ø¹Ø¯ Ø§Ù„ØªØ­ÙˆÙŠÙ„ØŒ Ø§Ø¶ØºØ· Ø§Ù„Ø²Ø± Ø¨Ø§Ù„Ø£Ø³ÙÙ„ Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥ÙŠØµØ§Ù„ Ù…Ø¹ ÙƒÙˆØ¯ Ø§Ù„Ø·Ø§Ù„Ø¨ ÙˆØ§Ø³Ù… Ø§Ù„ÙƒÙˆØ±Ø³ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨ ÙˆØ³ÙŠØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ø´ØªØ±Ø§ÙƒÙƒ ÙÙˆØ±Ø§Ù‹.</p>
                                </div>

                                <a href={`https://wa.me/${teacherNumber}?text=Ø§Ù„Ø³Ù„Ø§Ù… Ø¹Ù„ÙŠÙƒÙ…ØŒ Ù‚Ù…Øª Ø¨ØªØ­ÙˆÙŠÙ„ Ù…Ø¨Ù„Øº ${course.price} Ø¬Ù†ÙŠÙ‡ Ù„Ù„Ø§Ø´ØªØ±Ø§Ùƒ ÙÙŠ ÙƒÙˆØ±Ø³ "${course.title}".%0AÙƒÙˆØ¯ Ø§Ù„Ø·Ø§Ù„Ø¨: ${user?.code || 'ØºÙŠØ± Ù…ØªÙˆÙØ±'}%0AØ§Ù„Ø±Ø¬Ø§Ø¡ ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ`} 
                                   target="_blank" 
                                   className="flex items-center justify-center gap-2 w-full py-4 bg-[#25D366] hover:bg-[#1ebd59] text-white rounded-xl font-bold transition shadow-lg shadow-green-900/20">
                                    <Icon name="message-circle" /> Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥ÙŠØµØ§Ù„ ÙˆØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø¬Ø²
                                </a>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        // âœ… Enhanced Attendance Tracker
        const EnhancedAttendanceTracker = ({ attendance, studentId, onMarkAttendance }) => {
            const [todayMarked, setTodayMarked] = useState(false);
            const [loading, setLoading] = useState(false);
            
            const today = new Date().toISOString().split('T')[0];
            const studentAttendance = attendance[studentId] || {};
            const todayRecord = studentAttendance[today];
            
            const last7Days = [];
            for (let i = 6; i >= 0; i--) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                const dateStr = date.toISOString().split('T')[0];
                const record = studentAttendance[dateStr];
                last7Days.push({
                    date: dateStr,
                    dayName: date.toLocaleDateString('ar-EG', { weekday: 'short' }),
                    dayMonth: date.toLocaleDateString('ar-EG', { day: 'numeric', month: 'numeric' }),
                    status: record?.status || null
                });
            }
            
            const totalDays = Object.keys(studentAttendance).length;
            const presentDays = Object.values(studentAttendance).filter(r => r.status === 'present').length;
            const attendanceRate = totalDays > 0 ? Math.round((presentDays / totalDays) * 100) : 0;
            
            const handleMarkAttendance = async () => {
                if (todayRecord || loading) return;
                setLoading(true);
                try {
                    await onMarkAttendance(studentId, today, 'present');
                    setTodayMarked(true);
                } catch (error) {
                    console.error("Error marking attendance:", error);
                } finally {
                    setLoading(false);
                }
            };
            
            useEffect(() => {
                if (todayRecord) {
                    setTodayMarked(true);
                } else {
                    setTodayMarked(false);
                }
            }, [todayRecord]);

            return (
                <div className="glass-panel p-6 animate-slide-up border-r-4 border-[#2e7d32]">
                    <div className="flex items-center gap-3 mb-6">
                        <div className="glass-icon bg-[#2e7d32]/20 text-[#2e7d32] border-[#2e7d32]/30">
                            <Icon name="calendar-check" size={24} />
                        </div>
                        <div>
                            <h3 className="text-xl font-bold">â™ Ù†Ø¸Ø§Ù… Ø§Ù„Ø­Ø¶ÙˆØ±</h3>
                            <p className="text-xs text-slate-400">Ø³Ø¬Ù„ Ø­Ø¶ÙˆØ±Ùƒ Ø§Ù„ÙŠÙˆÙ…ÙŠ</p>
                        </div>
                    </div>

                    <div className="bg-gradient-to-r from-[#2e7d32]/30 to-[#1e5f22]/20 p-6 rounded-xl mb-6 text-center">
                        <button
                            onClick={handleMarkAttendance}
                            disabled={todayMarked || loading}
                            className={`px-8 py-4 rounded-xl font-bold text-lg flex items-center justify-center gap-3 mx-auto transition-all ${
                                todayMarked 
                                    ? 'bg-[#2e7d32] text-white cursor-not-allowed' 
                                    : 'btn-primary hover:scale-105'
                            }`}
                        >
                            {todayMarked ? (
                                <>
                                    <Icon name="check-circle" size={24} /> ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø­Ø¶ÙˆØ±Ùƒ Ø§Ù„ÙŠÙˆÙ…
                                </>
                            ) : (
                                <>
                                    <Icon name="log-in" size={24} /> Ø³Ø¬Ù„ Ø­Ø¶ÙˆØ±Ùƒ Ø§Ù„Ø¢Ù†
                                </>
                            )}
                        </button>
                        <p className="text-xs text-slate-400 mt-3">
                            {todayMarked 
                                ? 'Ø´ÙƒØ±Ø§Ù‹ Ù„Ùƒ! Ø³ÙŠØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø¶ÙˆØ± ØºØ¯Ø§Ù‹' 
                                : 'ÙŠÙ…ÙƒÙ†Ùƒ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ± Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø© ÙÙ‚Ø· ÙŠÙˆÙ…ÙŠØ§Ù‹'
                            }
                        </p>
                    </div>

                    <div className="mb-6">
                        <h4 className="text-sm font-bold mb-3 flex items-center gap-2">
                            <Icon name="calendar" size={16} /> Ø¢Ø®Ø± 7 Ø£ÙŠØ§Ù…
                        </h4>
                        <div className="grid grid-cols-7 gap-2">
                            {last7Days.map(day => (
                                <div key={day.date} className="text-center">
                                    <div className={`w-10 h-10 rounded-full mx-auto flex items-center justify-center text-sm font-bold border-2 ${
                                        day.status === 'present' 
                                            ? 'bg-[#2e7d32]/20 border-[#2e7d32] text-[#2e7d32]' 
                                            : day.status === 'absent' 
                                                ? 'bg-[#8b0000]/20 border-[#8b0000] text-[#8b0000]' 
                                                : 'border-white/10 bg-white/5 text-slate-500'
                                    }`}>
                                        {day.status === 'present' ? 'âœ“' : day.status === 'absent' ? 'âœ—' : '-'}
                                    </div>
                                    <span className="text-xs text-slate-400 mt-1 block">{day.dayMonth}</span>
                                </div>
                            ))}
                        </div>
                    </div>

                    <div className="bg-white/5 p-4 rounded-xl">
                        <div className="flex justify-between items-center mb-2">
                            <span className="text-sm font-bold">Ù†Ø³Ø¨Ø© Ø§Ù„Ø­Ø¶ÙˆØ± Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ©</span>
                            <span className="text-lg font-black text-green-400">{attendanceRate}%</span>
                        </div>
                        <div className="h-2 bg-white/10 rounded-full overflow-hidden mb-3">
                            <div 
                                className="h-full bg-[#2e7d32] rounded-full transition-all duration-500" 
                                style={{ width: `${attendanceRate}%` }}
                            ></div>
                        </div>
                        <div className="flex justify-between text-xs text-slate-400">
                            <span>âœ… Ø­Ø§Ø¶Ø±: {presentDays} ÙŠÙˆÙ…</span>
                            <span>âŒ ØºØ§Ø¦Ø¨: {totalDays - presentDays} ÙŠÙˆÙ…</span>
                            <span>ğŸ“Š Ø¥Ø¬Ù…Ø§Ù„ÙŠ: {totalDays} ÙŠÙˆÙ…</span>
                        </div>
                    </div>
                </div>
            );
        };

        // âœ… Exam Builder Component (Ù…Ø·ÙˆØ±)
        const ExamBuilder = ({ onClose, onSave, isDarkMode }) => {
            const [examMode, setExamMode] = useState(null);
            const [question, setQuestion] = useState('');
            const [options, setOptions] = useState([{ text: '', isCorrect: false }]);
            const [grade, setGrade] = useState('all');
            const [courseId, setCourseId] = useState('');
            const [courses, setCourses] = useState([]);

            useEffect(() => {
                // Ø¬Ù„Ø¨ Ø§Ù„ÙƒÙˆØ±Ø³Ø§Øª
                const coursesRef = window.rtdb.ref(window.db, 'courses');
                window.rtdb.onValue(coursesRef, (snapshot) => {
                    if (snapshot.exists()) {
                        const coursesArray = Object.entries(snapshot.val()).map(([id, data]) => ({ id, ...data }));
                        setCourses(coursesArray);
                    }
                });
            }, []);

            const addOption = () => {
                if (options.length < 6) {
                    setOptions([...options, { text: '', isCorrect: false }]);
                }
            };

            const updateOption = (index, text) => {
                const newOptions = [...options];
                newOptions[index].text = text;
                setOptions(newOptions);
            };

            const setCorrectAnswer = (index) => {
                const newOptions = options.map((opt, i) => ({ ...opt, isCorrect: i === index }));
                setOptions(newOptions);
            };

            const removeOption = (index) => {
                if (options.length > 2) {
                    setOptions(options.filter((_, i) => i !== index));
                }
            };

            const handleSave = () => {
                if (!question.trim()) return;

                const examData = {
                    type: examMode,
                    question,
                    grade,
                    courseId,
                    timestamp: Date.now()
                };

                if (examMode === 'mcq') {
                    examData.options = options.filter(o => o.text.trim());
                    examData.correctIndex = options.findIndex(o => o.isCorrect);
                }

                onSave(examData);
                onClose();
            };

            return (
                <div className="fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-[100] p-4" onClick={onClose}>
                    <div className="glass-panel p-8 max-w-2xl w-full max-h-[90vh] overflow-y-auto" onClick={e => e.stopPropagation()}>
                        <div className="flex items-center justify-between mb-6">
                            <h2 className="text-2xl font-bold flex items-center gap-2">
                                <div className="glass-icon"><Icon name="file-plus" size={24} /></div>
                                Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù…ØªØ­Ø§Ù† Ø¬Ø¯ÙŠØ¯
                            </h2>
                            <button onClick={onClose} className="p-2 hover:bg-white/10 rounded-xl">
                                <Icon name="x" size={24} />
                            </button>
                        </div>

                        {!examMode ? (
                            <div className="grid md:grid-cols-2 gap-4">
                                <button onClick={() => setExamMode('mcq')} className="glass-panel p-6 text-center hover:border-[#d4af37] transition group">
                                    <div className="glass-icon mx-auto mb-4 group-hover:shadow-lg">
                                        <Icon name="list-checks" size={32} />
                                    </div>
                                    <h3 className="font-bold mb-2">Ø§Ø®ØªÙŠØ§Ø± Ù…Ù† Ù…ØªØ¹Ø¯Ø¯</h3>
                                    <p className="text-xs text-slate-400">MCQ Ù…Ø¹ Ø¥Ø¬Ø§Ø¨Ø§Øª Ù…ØªØ¹Ø¯Ø¯Ø©</p>
                                </button>

                                <button onClick={() => setExamMode('essay')} className="glass-panel p-6 text-center hover:border-[#d4af37] transition group">
                                    <div className="glass-icon mx-auto mb-4 group-hover:shadow-lg">
                                        <Icon name="file-text" size={32} />
                                    </div>
                                    <h3 className="font-bold mb-2">Ø³Ø¤Ø§Ù„ Ù…Ù‚Ø§Ù„ÙŠ</h3>
                                    <p className="text-xs text-slate-400">Ø¥Ø¬Ø§Ø¨Ø© Ù†ØµÙŠØ© Ù…ÙØªÙˆØ­Ø©</p>
                                </button>
                            </div>
                        ) : (
                            <div className="space-y-6">
                                <button onClick={() => setExamMode(null)} className="flex items-center gap-2 text-slate-400 hover:text-white">
                                    <Icon name="arrow-right" size={18} /> Ø±Ø¬ÙˆØ¹ Ù„Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù†ÙˆØ¹
                                </button>

                                <div className="grid md:grid-cols-2 gap-4">
                                    <div>
                                        <label className="block text-sm font-bold mb-2">Ø§Ù„ØµÙ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ</label>
                                        <select value={grade} onChange={e => setGrade(e.target.value)}
                                            className="w-full p-3 bg-white/5 border border-white/10 rounded-xl">
                                            <option value="all">ÙƒÙ„ Ø§Ù„ØµÙÙˆÙ</option>
                                            <option value="1sec">Ø£ÙˆÙ„Ù‰ Ø«Ø§Ù†ÙˆÙŠ</option>
                                            <option value="2sec">ØªØ§Ù†ÙŠØ© Ø«Ø§Ù†ÙˆÙŠ</option>
                                            <option value="3sec">ØªØ§Ù„ØªØ© Ø«Ø§Ù†ÙˆÙŠ</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label className="block text-sm font-bold mb-2">Ø§Ù„ÙƒÙˆØ±Ø³</label>
                                        <select value={courseId} onChange={e => setCourseId(e.target.value)}
                                            className="w-full p-3 bg-white/5 border border-white/10 rounded-xl">
                                            <option value="">Ø§Ø®ØªØ± Ø§Ù„ÙƒÙˆØ±Ø³</option>
                                            {courses.map(course => (
                                                <option key={course.id} value={course.id}>{course.title}</option>
                                            ))}
                                        </select>
                                    </div>
                                </div>

                                <div>
                                    <label className="block text-sm font-bold mb-2">Ø§Ù„Ø³Ø¤Ø§Ù„</label>
                                    <textarea
                                        value={question}
                                        onChange={e => setQuestion(e.target.value)}
                                        placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ø³Ø¤Ø§Ù„ Ù‡Ù†Ø§..."
                                        className="w-full p-4 bg-white/5 border border-white/10 rounded-xl h-32 resize-none"
                                    />
                                </div>

                                {examMode === 'mcq' && (
                                    <div>
                                        <label className="block text-sm font-bold mb-2">Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±Ø§Øª</label>
                                        <div className="space-y-3">
                                            {options.map((option, index) => (
                                                <div key={index} className="flex items-center gap-3">
                                                    <input
                                                        type="radio"
                                                        name="correctAnswer"
                                                        checked={option.isCorrect}
                                                        onChange={() => setCorrectAnswer(index)}
                                                        className="w-5 h-5 accent-[#2e7d32]"
                                                    />
                                                    <input
                                                        type="text"
                                                        value={option.text}
                                                        onChange={e => updateOption(index, e.target.value)}
                                                        placeholder={`Ø§Ù„Ø§Ø®ØªÙŠØ§Ø± ${index + 1}`}
                                                        className="flex-1 p-3 bg-white/5 border border-white/10 rounded-xl"
                                                    />
                                                    {options.length > 2 && (
                                                        <button onClick={() => removeOption(index)} className="p-2 hover:bg-red-500/20 rounded-lg text-red-400">
                                                            <Icon name="trash-2" size={18} />
                                                        </button>
                                                    )}
                                                </div>
                                            ))}
                                        </div>
                                        <button onClick={addOption} className="mt-3 flex items-center gap-2 text-[#d4af37] hover:underline">
                                            <Icon name="plus-circle" size={18} /> Ø¥Ø¶Ø§ÙØ© Ø§Ø®ØªÙŠØ§Ø±
                                        </button>
                                    </div>
                                )}

                                <div className="flex gap-3 pt-4">
                                    <button onClick={onClose} className="flex-1 py-4 bg-white/10 rounded-xl font-bold">Ø¥Ù„ØºØ§Ø¡</button>
                                    <button onClick={handleSave} className="flex-1 btn-primary py-4 rounded-xl font-bold">
                                        Ø­ÙØ¸ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†
                                    </button>
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        // âœ… Student Enrolled Courses Component
        const StudentEnrolledCourses = ({ user, enrolledCourses, onBackToHome }) => {
            if (!user) return null;

            return (
                <div className="glass-panel p-6 animate-slide-up">
                    <div className="flex items-center gap-3 mb-6">
                        <div className="glass-icon bg-[#2e7d32]/20 text-[#2e7d32] border-[#2e7d32]/30">
                            <Icon name="check-circle" size={24} />
                        </div>
                        <div>
                            <h2 className="text-xl font-bold">â™ ÙƒÙˆØ±Ø³Ø§ØªÙŠ Ø§Ù„Ù…ÙØ¹Ù„Ø©</h2>
                            <p className="text-xs text-slate-400">Ø§Ù„ÙƒÙˆØ±Ø³Ø§Øª Ø§Ù„ØªÙŠ Ù‚Ù…Øª Ø¨Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ ÙÙŠÙ‡Ø§</p>
                        </div>
                    </div>

                    {enrolledCourses.length === 0 ? (
                        <div className="text-center py-12 border border-dashed border-white/10 rounded-xl">
                            <GlassIcon name="book-open" size={48} className="mx-auto mb-4 opacity-50" />
                            <h3 className="text-lg font-bold mb-2">Ù„Ø§ ØªÙˆØ¬Ø¯ ÙƒÙˆØ±Ø³Ø§Øª Ù…ÙØ¹Ù„Ø©</h3>
                            <p className="text-sm text-slate-400 mb-6">Ù„Ù… ØªÙ‚Ù… Ø¨Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ ÙÙŠ Ø£ÙŠ ÙƒÙˆØ±Ø³ Ø¨Ø¹Ø¯</p>
                            <button 
                                onClick={onBackToHome}
                                className="btn-primary px-6 py-3 rounded-xl font-bold inline-flex items-center gap-2"
                            >
                                <Icon name="shopping-cart" size={18} /> ØªØµÙØ­ Ø§Ù„ÙƒÙˆØ±Ø³Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø©
                            </button>
                        </div>
                    ) : (
                        <div className="grid md:grid-cols-2 gap-4">
                            {enrolledCourses.map(course => (
                                <div key={course.id} className="bg-white/5 rounded-xl border border-[#2e7d32]/30 overflow-hidden hover:border-[#2e7d32] transition group">
                                    <div className="h-32 bg-[#8b0000]/20 relative">
                                        {course.image ? (
                                            <img src={course.image} className="w-full h-full object-cover opacity-60" />
                                        ) : (
                                            <div className="w-full h-full flex items-center justify-center text-[#d4af37] text-4xl">ğŸ“š</div>
                                        )}
                                        <div className="absolute inset-0 bg-gradient-to-t from-black/80 to-transparent flex items-end p-3">
                                            <h3 className="font-bold text-white">{course.title}</h3>
                                        </div>
                                        <span className="absolute top-2 right-2 bg-[#2e7d32] text-white px-2 py-1 rounded-lg text-xs font-bold">
                                            Ù…ÙØ¹Ù„ âœ“
                                        </span>
                                    </div>
                                    <div className="p-4">
                                        <p className="text-sm text-slate-400 line-clamp-2 mb-3">{course.description}</p>
                                        <div className="flex justify-between items-center">
                                            <span className={`text-xs px-2 py-1 rounded grade-badge-${course.grade}`}>
                                                {course.grade === '1sec' ? 'Ø£ÙˆÙ„Ù‰ Ø«Ø§Ù†ÙˆÙŠ' : course.grade === '2sec' ? 'ØªØ§Ù†ÙŠØ© Ø«Ø§Ù†ÙˆÙŠ' : 'ØªØ§Ù„ØªØ© Ø«Ø§Ù†ÙˆÙŠ'}
                                            </span>
                                            <button 
                                                onClick={() => window.location.href = '#lectures'}
                                                className="bg-[#2e7d32]/20 hover:bg-[#2e7d32] text-[#2e7d32] hover:text-white px-3 py-1 rounded-lg text-xs font-bold transition flex items-center gap-1"
                                            >
                                                <Icon name="play-circle" size={14} /> Ù…Ø´Ø§Ù‡Ø¯Ø© Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            ))}
                        </div>
                    )}
                </div>
            );
        };

        // âœ… Subscription Activation Modal for Admin
        const SubscriptionActivationModal = ({ student, onClose, onActivate, courses }) => {
            const [selectedCourse, setSelectedCourse] = useState('');
            const [days, setDays] = useState(30);
            const [loading, setLoading] = useState(false);

            const handleActivate = async () => {
                if (!selectedCourse) {
                    alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± ÙƒÙˆØ±Ø³ Ù„Ù„ØªÙØ¹ÙŠÙ„');
                    return;
                }
                setLoading(true);
                try {
                    await onActivate(student.id, selectedCourse, days);
                    onClose();
                } catch (error) {
                    console.error("Activation error:", error);
                } finally {
                    setLoading(false);
                }
            };

            return (
                <div className="fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-[200] p-4" onClick={onClose}>
                    <div className="glass-panel p-8 max-w-md w-full animate-scale-in" onClick={e => e.stopPropagation()}>
                        <h3 className="text-2xl font-bold mb-6 flex items-center gap-2">
                            <GlassIcon name="zap" className="text-[#2e7d32]" />
                            ØªÙØ¹ÙŠÙ„ Ø§Ø´ØªØ±Ø§Ùƒ Ø§Ù„Ø·Ø§Ù„Ø¨
                        </h3>

                        <div className="mb-6">
                            <p className="text-sm text-slate-400 mb-2">Ø§Ù„Ø·Ø§Ù„Ø¨:</p>
                            <div className="bg-white/5 p-3 rounded-xl flex items-center gap-3">
                                <img src={student.photo} className="w-10 h-10 rounded-full" />
                                <div>
                                    <p className="font-bold">{student.name}</p>
                                    <p className="text-xs text-slate-400">{student.email}</p>
                                </div>
                            </div>
                        </div>

                        <div className="space-y-4 mb-6">
                            <div>
                                <label className="block text-sm font-bold mb-2">Ø§Ø®ØªØ± Ø§Ù„ÙƒÙˆØ±Ø³ Ù„Ù„ØªÙØ¹ÙŠÙ„</label>
                                <select 
                                    value={selectedCourse}
                                    onChange={e => setSelectedCourse(e.target.value)}
                                    className="w-full p-4 bg-white/5 border border-white/10 rounded-xl outline-none"
                                >
                                    <option value="">-- Ø§Ø®ØªØ± ÙƒÙˆØ±Ø³ --</option>
                                    {courses.map(course => (
                                        <option key={course.id} value={course.id}>
                                            {course.title} - {course.grade === '1sec' ? 'Ø£ÙˆÙ„Ù‰ Ø«Ø§Ù†ÙˆÙŠ' : course.grade === '2sec' ? 'ØªØ§Ù†ÙŠØ© Ø«Ø§Ù†ÙˆÙŠ' : 'ØªØ§Ù„ØªØ© Ø«Ø§Ù†ÙˆÙŠ'}
                                        </option>
                                    ))}
                                </select>
                            </div>

                            <div>
                                <label className="block text-sm font-bold mb-2">Ù…Ø¯Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ (Ø£ÙŠØ§Ù…)</label>
                                <input 
                                    type="number"
                                    value={days}
                                    onChange={e => setDays(parseInt(e.target.value) || 30)}
                                    min="1"
                                    max="365"
                                    className="w-full p-4 bg-white/5 border border-white/10 rounded-xl outline-none"
                                />
                            </div>
                        </div>

                        <div className="flex gap-3">
                            <button 
                                onClick={onClose}
                                className="flex-1 py-4 bg-white/10 rounded-xl font-bold hover:bg-white/20 transition"
                            >
                                Ø¥Ù„ØºØ§Ø¡
                            </button>
                            <button 
                                onClick={handleActivate}
                                disabled={loading || !selectedCourse}
                                className="flex-1 btn-primary py-4 rounded-xl font-bold disabled:opacity-50 disabled:cursor-not-allowed"
                            >
                                {loading ? 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªÙØ¹ÙŠÙ„...' : 'ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ'}
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        // âœ… Subscription Manager
        const SubscriptionManager = ({ students, courses, onConfirmPayment, onDeactivate, isSuperAdmin }) => {
            const [searchTerm, setSearchTerm] = useState('');
            const [yearFilter, setYearFilter] = useState('all');
            const [selectedStudent, setSelectedStudent] = useState(null);
            const [showActivationModal, setShowActivationModal] = useState(false);

            const filteredStudents = students.filter(s => {
                const matchesSearch = s.name?.toLowerCase().includes(searchTerm.toLowerCase()) || s.email?.toLowerCase().includes(searchTerm.toLowerCase());
                if (yearFilter !== 'all' && s.grade !== yearFilter) return false;
                return matchesSearch && !['admin', 'boss'].includes(s.role);
            });

            const handleActivateSubscription = async (studentId, courseId, days) => {
                const endDate = new Date();
                endDate.setDate(endDate.getDate() + days);
                
                const student = students.find(s => s.id === studentId);
                const currentEnrolled = student?.enrolledCourses || [];
                
                if (!currentEnrolled.includes(courseId)) {
                    const updatedEnrolled = [...currentEnrolled, courseId];
                    
                    await window.rtdb.update(window.rtdb.ref(window.db, `users/${studentId}`), {
                        isPaid: true,
                        enrolledCourses: updatedEnrolled,
                        subscriptionEnd: endDate.toISOString(),
                        subscriptionStart: new Date().toISOString()
                    });
                    
                    onConfirmPayment(studentId, days);
                } else {
                    alert('Ø§Ù„Ø·Ø§Ù„Ø¨ Ù…Ø´ØªØ±Ùƒ Ø¨Ø§Ù„ÙØ¹Ù„ ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„ÙƒÙˆØ±Ø³');
                }
            };

            return (
                <div className="space-y-6 animate-slide-up">
                    <div className="glass-panel p-6 space-y-4">
                        <h2 className="text-2xl font-bold flex items-center gap-2">
                            <GlassIcon name="credit-card" size={24} /> Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª
                        </h2>

                        <div className="flex flex-wrap gap-4 items-center">
                            <input
                                placeholder="Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù… Ø£Ùˆ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ..."
                                value={searchTerm}
                                onChange={e => setSearchTerm(e.target.value)}
                                className="bg-white/5 border border-white/10 p-3 rounded-xl flex-1 min-w-[250px] outline-none"
                            />

                            <div className="flex bg-white/5 p-1 rounded-xl border border-white/10">
                                {['all', '1sec', '2sec', '3sec'].map(y => (
                                    <button
                                        key={y}
                                        onClick={() => setYearFilter(y)}
                                        className={`px-4 py-2 rounded-lg text-sm font-bold transition ${yearFilter === y ? 'bg-[#8b0000] text-white shadow-lg' : 'text-slate-400 hover:text-white'}`}
                                    >
                                        {y === 'all' ? 'Ø§Ù„ÙƒÙ„' : y === '1sec' ? '1Ø«' : y === '2sec' ? '2Ø«' : '3Ø«'}
                                    </button>
                                ))}
                            </div>
                        </div>
                    </div>

                    <div className="glass-panel overflow-hidden">
                        <div className="overflow-x-auto">
                            <table className="w-full text-right min-w-[1000px]">
                                <thead className="bg-[#8b0000]/20 text-slate-300">
                                    <tr>
                                        <th className="p-4">Ø§Ù„Ø·Ø§Ù„Ø¨</th>
                                        <th className="p-4">Ø§Ù„ÙƒÙˆØ±Ø³Ø§Øª Ø§Ù„Ù…ÙØ¹Ù„Ø©</th>
                                        <th className="p-4">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡</th>
                                        <th className="p-4">Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {filteredStudents.map(student => {
                                        const daysLeft = student.subscriptionEnd ? Math.ceil((new Date(student.subscriptionEnd) - new Date()) / (1000 * 60 * 60 * 24)) : 0;
                                        const enrolledCourses = student.enrolledCourses || [];
                                        const enrolledCourseDetails = courses.filter(c => enrolledCourses.includes(c.id));

                                        return (
                                            <tr key={student.id} className="border-b border-white/5 hover:bg-white/5 transition">
                                                <td className="p-4">
                                                    <div className="flex items-center gap-3">
                                                        <div className="w-10 h-10 rounded-full bg-slate-700 overflow-hidden">
                                                            <img src={student.photo} className="w-full h-full object-cover" />
                                                        </div>
                                                        <div>
                                                            <p className="font-bold">{student.name}</p>
                                                            <p className="text-xs text-slate-400">{student.email}</p>
                                                            <p className="text-xs text-slate-500 mt-1">ÙƒÙˆØ¯: {student.code}</p>
                                                        </div>
                                                    </div>
                                                </td>
                                                <td className="p-4">
                                                    {enrolledCourseDetails.length > 0 ? (
                                                        <div className="flex flex-wrap gap-1">
                                                            {enrolledCourseDetails.map(c => (
                                                                <span key={c.id} className="bg-[#2e7d32]/20 text-green-300 px-2 py-1 rounded text-xs font-bold">
                                                                    {c.title}
                                                                </span>
                                                            ))}
                                                        </div>
                                                    ) : (
                                                        <span className="text-slate-500 text-sm">Ù„Ø§ ÙŠÙˆØ¬Ø¯</span>
                                                    )}
                                                </td>
                                                <td className="p-4 font-mono text-sm">
                                                    {student.isPaid && student.subscriptionEnd ? (
                                                        <div className={daysLeft > 0 ? "text-green-400" : "text-red-400"}>
                                                            {new Date(student.subscriptionEnd).toLocaleDateString('en-CA')}
                                                            <div className="text-xs opacity-70">
                                                                {daysLeft > 0 ? `Ø¨Ø§Ù‚ÙŠ ${daysLeft} ÙŠÙˆÙ…` : 'Ù…Ù†ØªÙ‡ÙŠ'}
                                                            </div>
                                                        </div>
                                                    ) : (
                                                        <span className="text-slate-500 font-bold">--</span>
                                                    )}
                                                </td>
                                                <td className="p-4">
                                                    <div className="flex gap-2 flex-wrap">
                                                        <button 
                                                            onClick={() => {
                                                                setSelectedStudent(student);
                                                                setShowActivationModal(true);
                                                            }}
                                                            className="bg-[#2e7d32] hover:bg-[#3e9142] text-white px-3 py-1.5 rounded-lg text-xs font-bold transition flex items-center gap-1 shadow-md"
                                                        >
                                                            <Icon name="zap" size={14} /> ØªÙØ¹ÙŠÙ„ ÙƒÙˆØ±Ø³
                                                        </button>
                                                        
                                                        <button 
                                                            onClick={() => {
                                                                if (confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ù„ØºØ§Ø¡ Ø§Ø´ØªØ±Ø§Ùƒ ${student.name}ØŸ`)) {
                                                                    onDeactivate(student.id);
                                                                }
                                                            }} 
                                                            className="bg-[#8b0000] hover:bg-[#a00000] text-white px-3 py-1.5 rounded-lg text-xs font-bold transition flex items-center gap-1 shadow-md"
                                                        >
                                                            <Icon name="x-circle" size={14} /> Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ
                                                        </button>
                                                    </div>
                                                </td>
                                            </tr>
                                        );
                                    })}
                                </tbody>
                            </table>
                        </div>
                    </div>

                    {showActivationModal && selectedStudent && (
                        <SubscriptionActivationModal
                            student={selectedStudent}
                            courses={courses}
                            onClose={() => {
                                setShowActivationModal(false);
                                setSelectedStudent(null);
                            }}
                            onActivate={handleActivateSubscription}
                        />
                    )}
                </div>
            );
        };

        // âœ… Results Page Component
        const ResultsPage = ({ results, students }) => {
            return (
                <div className="space-y-6 animate-slide-up">
                    <h2 className="text-2xl font-bold flex items-center gap-2">
                        <GlassIcon name="award" size={24} /> Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†Ø§Øª
                    </h2>

                    {results.length === 0 ? (
                        <div className="glass-panel p-12 text-center">
                            <Icon name="award" size={48} className="mx-auto mb-4 text-gray-500" />
                            <p className="text-gray-400">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ø¨Ø¹Ø¯</p>
                        </div>
                    ) : (
                        <div className="glass-panel overflow-hidden">
                            <table className="w-full text-right">
                                <thead className="bg-[#8b0000]/20">
                                    <tr>
                                        <th className="p-4">Ø§Ù„Ø·Ø§Ù„Ø¨</th>
                                        <th className="p-4">Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†</th>
                                        <th className="p-4">Ø§Ù„Ø¯Ø±Ø¬Ø©</th>
                                        <th className="p-4">Ø§Ù„Ù†Ø³Ø¨Ø©</th>
                                        <th className="p-4">Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {results.map(result => {
                                        const student = students.find(s => s.id === result.studentId);
                                        return (
                                            <tr key={result.id} className="border-b border-white/5">
                                                <td className="p-4">
                                                    <div className="flex items-center gap-2">
                                                        <img src={student?.photo} className="w-8 h-8 rounded-full" />
                                                        <span>{student?.name || result.studentName}</span>
                                                    </div>
                                                </td>
                                                <td className="p-4">{result.examTitle}</td>
                                                <td className="p-4">{result.score} / {result.total}</td>
                                                <td className="p-4">
                                                    <span className={`px-2 py-1 rounded text-xs ${
                                                        result.percentage >= 70 ? 'bg-[#2e7d32]/20 text-green-300' :
                                                        result.percentage >= 50 ? 'bg-[#d4af37]/20 text-yellow-300' :
                                                        'bg-[#8b0000]/20 text-red-300'
                                                    }`}>
                                                        {Math.round(result.percentage)}%
                                                    </span>
                                                </td>
                                                <td className="p-4 text-sm text-slate-400">
                                                    {new Date(result.submittedAt).toLocaleDateString('ar-EG')}
                                                </td>
                                            </tr>
                                        );
                                    })}
                                </tbody>
                            </table>
                        </div>
                    )}
                </div>
            );
        };

        // âœ… Courses Catalog Component
        const CoursesCatalog = ({ courses, onSelect }) => {
            return (
                <div className="glass-panel p-6 animate-slide-up">
                    <div className="flex items-center gap-3 mb-6">
                        <div className="glass-icon bg-purple-500/20 text-purple-500 border-purple-500/30">
                            <Icon name="book-open" size={24} />
                        </div>
                        <div>
                            <h2 className="text-xl font-bold">â™ Ø§Ù„ÙƒÙˆØ±Ø³Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø©</h2>
                            <p className="text-xs text-slate-400">Ø§Ø®ØªØ± Ø§Ù„Ø¨Ø§Ù‚Ø© Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø© Ù„Ù…Ø³ØªÙˆØ§Ùƒ</p>
                        </div>
                    </div>

                    <div className="grid md:grid-cols-3 gap-4">
                        {courses.map((course, index) => (
                            <div 
                                key={course.id || index} 
                                onClick={() => onSelect && onSelect(course)}
                                className="bg-white/5 rounded-xl border border-white/10 overflow-hidden hover:scale-105 transition-transform duration-300 cursor-pointer min-h-[400px] flex flex-col"
                            >
                                <div className="h-48 bg-[#8b0000]/20 relative">
                                    {course.image ? (
                                        <img src={course.image} className="w-full h-full object-cover opacity-60" />
                                    ) : (
                                        <div className="w-full h-full flex items-center justify-center text-[#d4af37] text-4xl">ğŸ“š</div>
                                    )}
                                    <span className="absolute top-2 right-2 bg-[#d4af37]/20 text-[#d4af37] px-2 py-1 rounded-lg text-xs font-bold border border-[#d4af37]/30">
                                        {course.grade === '1sec' ? 'Ø£ÙˆÙ„Ù‰ Ø«Ø§Ù†ÙˆÙŠ' : course.grade === '2sec' ? 'ØªØ§Ù†ÙŠØ© Ø«Ø§Ù†ÙˆÙŠ' : 'ØªØ§Ù„ØªØ© Ø«Ø§Ù†ÙˆÙŠ'}
                                    </span>
                                </div>
                                <div className="p-4 flex-1 flex flex-col justify-between">
                                    <div>
                                        <h3 className="font-bold text-lg mb-1 line-clamp-1">{course.title}</h3>
                                        <p className="text-xs text-slate-400 mb-3 line-clamp-2">{course.description}</p>
                                    </div>
                                    <div className="flex justify-between items-center mt-auto">
                                        <span className="text-2xl font-black text-[#d4af37]">{course.price} <span className="text-xs text-slate-500">Ø¬.Ù…</span></span>
                                        <span className="text-xs text-slate-500">{course.duration} ÙŠÙˆÙ…</span>
                                    </div>
                                </div>
                            </div>
                        ))}
                    </div>
                </div>
            );
        };

        // âœ… Honor Board Component
        const HonorBoard = ({ students }) => {
            const topStudents = students
                .filter(s => !['admin', 'boss'].includes(s.role))
                .map(s => ({ ...s, points: s.points || 0 }))
                .sort((a, b) => b.points - a.points)
                .slice(0, 10);

            const getGradeBadge = (grade) => {
                if (grade === '1sec') return { text: 'Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„', color: 'grade-badge-1sec' };
                if (grade === '2sec') return { text: 'Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù†ÙŠ', color: 'grade-badge-2sec' };
                return { text: 'Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù„Ø«', color: 'grade-badge-3sec' };
            };

            return (
                <div className="glass-panel p-6 animate-slide-up">
                    <div className="flex items-center gap-3 mb-6">
                        <div className="glass-icon bg-gradient-to-r from-[#d4af37]/30 to-[#b8860b]/20 border-[#d4af37]">
                            <Icon name="award" size={24} className="text-[#d4af37]" />
                        </div>
                        <div>
                            <h2 className="text-xl font-bold">â™ ÙØ±Ø³Ø§Ù† Ø§Ù„ØªÙÙˆÙ‚</h2>
                            <p className="text-xs text-slate-400">Ø£ÙØ¶Ù„ 10 Ø·Ù„Ø§Ø¨ Ø¨Ø§Ù„Ù…Ù†ØµØ©</p>
                        </div>
                    </div>

                    <div className="space-y-3">
                        {topStudents.length === 0 ? (
                            <div className="text-center py-8 text-slate-400">
                                <Icon name="users" size={40} className="mx-auto mb-2 opacity-50" />
                                <p>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ù„Ø§Ø¨ Ø¨Ø¹Ø¯</p>
                            </div>
                        ) : (
                            topStudents.map((student, index) => {
                                const gradeBadge = getGradeBadge(student.grade);
                                return (
                                    <div key={student.id} className={`p-4 rounded-xl flex items-center gap-4 transition hover:scale-[1.02] ${
                                        index === 0 ? 'bg-gradient-to-r from-yellow-500/30 to-yellow-600/20 border-2 border-yellow-500' :
                                        index === 1 ? 'bg-gradient-to-r from-slate-400/20 to-slate-500/10 border border-slate-400' :
                                        index === 2 ? 'bg-gradient-to-r from-orange-600/20 to-orange-700/10 border border-orange-600' :
                                        'bg-white/5 border border-white/10'
                                    }`}>
                                        <div className={`w-10 h-10 rounded-full flex items-center justify-center font-black text-lg ${
                                            index === 0 ? 'bg-yellow-500 text-black' :
                                            index === 1 ? 'bg-slate-400 text-black' :
                                            index === 2 ? 'bg-orange-600 text-white' :
                                            'bg-white/10 text-slate-400'
                                        }`}>
                                            {index === 0 ? 'ğŸ‘‘' : index + 1}
                                        </div>
                                        <img src={student.photo || 'https://via.placeholder.com/40'} className={`w-12 h-12 rounded-full ${index === 0 ? 'border-4 border-yellow-500' : 'border-2 border-white/20'}`} />
                                        <div className="flex-1">
                                            <p className={`font-bold ${index === 0 ? 'text-yellow-300' : ''}`}>{student.name}</p>
                                            <div className="flex items-center gap-2 mt-1">
                                                <span className={`px-2 py-0.5 rounded-full text-xs font-bold ${gradeBadge.color}`}>
                                                    {gradeBadge.text}
                                                </span>
                                                <RankBadge points={student.points} />
                                            </div>
                                        </div>
                                        <div className="text-right">
                                            <p className={`text-2xl font-black ${index === 0 ? 'text-yellow-400' : 'text-[#d4af37]'}`}>
                                                {student.points}
                                            </p>
                                            <p className="text-xs text-slate-400">Ù†Ù‚Ø·Ø©</p>
                                        </div>
                                    </div>
                                );
                            })
                        )}
                    </div>
                </div>
            );
        };

        // ================ Ø§Ù„Ù…ÙƒÙˆÙ† Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ ================
        const App = () => {
            const [isDarkMode, setIsDarkMode] = useState(true);
            const [user, setUser] = useState(null);
            const [userType, setUserType] = useState(null);
            const [view, setView] = useState('loading');
            const [dataState, setDataState] = useState({
                students: [], requests: [], lectures: [], whiteboards: [],
                qa: [], exams: [], announcements: [], payments: [], subscriptions: {},
                flashcards: [], recordings: [], attendance: {}, courses: [], examResults: []
            });

            const [regData, setRegData] = useState({
                phone: '', parentPhone: '', school: '', governorate: '', city: '',
                grade: '1sec', accountType: 'student', linkedStudentEmail: '',
                firstName: '', fatherName: '', grandfatherName: '', bio: ''
            });

            const [activeTab, setActiveTab] = useState('home');
            const [gradeFilter, setGradeFilter] = useState('all');
            const [selectedLecture, setSelectedLecture] = useState(null);
            const [selectedExam, setSelectedExam] = useState(null);
            const [examAnswers, setExamAnswers] = useState({});
            const [examResult, setExamResult] = useState(null);
            const [sidebarOpen, setSidebarOpen] = useState(false);
            const [notification, setNotification] = useState(null);
            const [showStudentModal, setShowStudentModal] = useState(false);
            const [selectedStudent, setSelectedStudent] = useState(null);
            const [searchQuery, setSearchQuery] = useState('');
            const [previewAsStudent, setPreviewAsStudent] = useState(false);
            const [showPhoneLogin, setShowPhoneLogin] = useState(false);
            const [showExamBuilder, setShowExamBuilder] = useState(false);
            const [showLoginModal, setShowLoginModal] = useState(false);
            const [selectedCourse, setSelectedCourse] = useState(null);

            const isSuperAdmin = user?.email === SUPER_ADMIN_EMAIL;

            // Ø§Ù„ÙƒÙˆØ±Ø³Ø§Øª Ø§Ù„Ù„ÙŠ Ø§Ù„Ø·Ø§Ù„Ø¨ Ù…Ø´ØªØ±Ùƒ ÙÙŠÙ‡Ø§
            const enrolledCourses = user?.enrolledCourses || [];
            
            // Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª Ø§Ù„Ù…ÙÙ„ØªØ±Ø© Ø­Ø³Ø¨ Ø§Ù„ØµÙ ÙˆØ§Ù„ÙƒÙˆØ±Ø³Ø§Øª Ø§Ù„Ù…Ø´ØªØ±Ùƒ ÙÙŠÙ‡Ø§
            const getFilteredLectures = () => {
                if (!user || view !== 'student') return [];
                
                return dataState.lectures.filter(lecture => {
                    if (gradeFilter !== 'all' && lecture.grade !== gradeFilter) return false;
                    if (lecture.isFree) return true;
                    if (lecture.courseId && enrolledCourses.includes(lecture.courseId)) return true;
                    return false;
                });
            };

            // Ø§Ù„Ø³Ø¨ÙˆØ±Ø§Øª Ø§Ù„Ù…ÙÙ„ØªØ±Ø© Ø­Ø³Ø¨ Ø§Ù„ØµÙ
            const getFilteredWhiteboards = () => {
                if (!user || view !== 'student') return [];
                return dataState.whiteboards.filter(wb => {
                    if (gradeFilter !== 'all' && wb.grade !== gradeFilter) return false;
                    return wb.grade === user?.grade;
                });
            };

            // Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†Ø§Øª Ø§Ù„Ù…ÙÙ„ØªØ±Ø© Ø­Ø³Ø¨ Ø§Ù„ØµÙ
            const getFilteredExams = () => {
                if (!user || view !== 'student') return [];
                return dataState.exams.filter(exam => {
                    if (gradeFilter !== 'all' && exam.grade !== gradeFilter) return false;
                    return exam.grade === user?.grade || exam.grade === 'all';
                });
            };

            // Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø·Ø§Ù„Ø¨
            const getStudentResults = () => {
                if (!user) return [];
                return dataState.examResults.filter(r => r.studentId === user.uid);
            };

            const showNotification = (message, type = 'success', action = null) => {
                setNotification({ message, type, action });
                setTimeout(() => setNotification(null), 5000);
            };

            // ================ Ù…ØªØ§Ø¨Ø¹Ø© Ø­Ø§Ù„Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ================
            useEffect(() => {
                const unsubscribeAuth = window.authMethods.onAuthStateChanged(window.auth, (u) => {
                    if (u) {
                        if (u.email === SUPER_ADMIN_EMAIL || u.uid === SUPER_ADMIN_UID) { 
                            const bossData = {
                                uid: u.uid,
                                name: 'Ø§Ù„Ù…Ø¯ÙŠØ± Ø§Ù„Ø£Ø¹Ù„Ù‰',
                                email: u.email,
                                photo: u.photoURL,
                                role: 'boss',
                                accountType: 'admin',
                                isPaid: true,
                                isSuperAdmin: true
                            };
                            setUser(bossData);
                            setUserType('admin');
                            setView('admin');
                            window.rtdb.update(window.rtdb.ref(window.db, `users/${u.uid}`), bossData);
                            return;
                        }

                        const userRef = window.rtdb.ref(window.db, `users/${u.uid}`);
                        const unsubscribeUser = window.rtdb.onValue(userRef, (snapshot) => {
                            if (snapshot.exists()) {
                                const userData = snapshot.val();
                                setUser({ ...userData, uid: u.uid, photo: u.photoURL });
                                setUserType(userData.role || 'student');
                                setView(['admin', 'boss'].includes(userData.role) ? 'admin' : 'student');
                            } else {
                                window.rtdb.get(window.rtdb.ref(window.db, `requests/${u.uid}`)).then(reqSnap => {
                                    if (reqSnap.exists()) {
                                        setUser({ uid: u.uid, name: u.displayName, email: u.email, photo: u.photoURL });
                                        setView('waiting-approval');
                                    } else {
                                        setUser({ uid: u.uid, name: u.displayName, email: u.email, photo: u.photoURL, isNew: true });
                                        setView('complete-profile');
                                    }
                                });
                            }
                        });
                    } else {
                        setUser(null);
                        setView('landing');
                    }
                });
                return () => unsubscribeAuth();
            }, []);

            // ================ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Firebase ================
            useEffect(() => {
                const collections = ['lectures', 'whiteboards', 'qa', 'announcements', 'exams', 'flashcards', 'recordings', 'courses', 'examResults'];
                collections.forEach(t =>
                    window.rtdb.onValue(window.rtdb.ref(window.db, t), s =>
                        setDataState(p => ({
                            ...p,
                            [t]: s.val() ? Object.entries(s.val()).map(([k, v]) => ({ id: k, ...v })).sort((a, b) => (b.ts || 0) - (a.ts || 0)) : []
                        }))
                    )
                );

                if (user && ['admin', 'boss'].includes(user.role)) {
                    window.rtdb.onValue(window.rtdb.ref(window.db, 'requests'), s =>
                        setDataState(p => ({ ...p, requests: s.val() ? Object.entries(s.val()).map(([k, v]) => ({ id: k, ...v })) : [] }))
                    );
                    window.rtdb.onValue(window.rtdb.ref(window.db, 'users'), s =>
                        setDataState(p => ({ ...p, students: s.val() ? Object.entries(s.val()).map(([k, v]) => ({ id: k, ...v })) : [] }))
                    );
                    window.rtdb.onValue(window.rtdb.ref(window.db, 'attendance'), s =>
                        setDataState(p => ({ ...p, attendance: s.val() || {} }))
                    );
                }
            }, [user]);

            // ================ Ø¯ÙˆØ§Ù„ Firebase ================
            const handleGoogleLogin = () => {
                setShowLoginModal(false);
                window.authMethods.signInWithPopup(window.auth, window.googleProvider);
            };

            const handlePhoneLogin = () => {
                setShowLoginModal(false);
                setShowPhoneLogin(true);
            };

            const handleLogout = async () => {
                await window.authMethods.signOut(window.auth);
                setView('landing');
            };

            const handleStudentRegistration = async () => {
                if (!regData.firstName || !regData.fatherName || !regData.grandfatherName) {
                    showNotification('âš ï¸ ÙŠØ¬Ø¨ ÙƒØªØ§Ø¨Ø© Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø«Ù„Ø§Ø«ÙŠ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„', 'error');
                    return;
                }

                if (!regData.bio || regData.bio.length < 10) {
                    showNotification('âš ï¸ Ø§ÙƒØªØ¨ Ù†Ø¨Ø°Ø© Ù…Ø®ØªØµØ±Ø© Ø¹Ù† Ù†ÙØ³Ùƒ', 'error');
                    return;
                }

                if (regData.phone.length !== 11 || regData.parentPhone.length !== 11) {
                    showNotification('âš ï¸ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† 11 Ø±Ù‚Ù…', 'error');
                    return;
                }

                if (!regData.school || !regData.governorate || !regData.city) {
                    showNotification('âš ï¸ Ø£ÙƒÙ…Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'error');
                    return;
                }

                try {
                    const displayName = `${regData.firstName} ${regData.fatherName} ${regData.grandfatherName}`.trim();

                    await window.rtdb.set(window.rtdb.ref(window.db, `requests/${user.uid}`), {
                        ...regData,
                        uid: user.uid,
                        name: displayName,
                        displayName: displayName,
                        email: user.email || 'Phone Login',
                        photo: user.photo || 'https://via.placeholder.com/150',
                        date: new Date().toLocaleDateString('ar-EG'),
                        ts: Date.now(),
                        requestType: regData.accountType,
                        status: 'pending'
                    });

                    showNotification('ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨Ùƒ Ø¨Ù†Ø¬Ø§Ø­! ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©.', 'success');
                    setView('waiting-approval');

                } catch (error) {
                    console.error("âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ³Ø¬ÙŠÙ„:", error);
                    showNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„: ' + error.message, 'error');
                }
            };

            const approveStudent = async (request) => {
                if (!isSuperAdmin) {
                    showNotification('ØºÙŠØ± Ù…ØµØ±Ø­ Ù„Ùƒ Ø¨Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡', 'error');
                    return;
                }

                try {
                    const studentCode = `STD${Date.now().toString().slice(-6)}`;
                    
                    const studentData = {
                        uid: request.uid,
                        name: request.name || request.displayName,
                        email: request.email,
                        photo: request.photo,
                        phone: request.phone || '',
                        parentPhone: request.parentPhone || '',
                        school: request.school || '',
                        governorate: request.governorate || '',
                        city: request.city || '',
                        grade: request.grade || '1sec',
                        firstName: request.firstName || '',
                        fatherName: request.fatherName || '',
                        grandfatherName: request.grandfatherName || '',
                        bio: request.bio || '',
                        role: 'student',
                        isPaid: false,
                        code: studentCode,
                        accountType: request.requestType || 'student',
                        enrolledCourses: [],
                        points: 0,
                        createdAt: Date.now()
                    };

                    await window.rtdb.set(window.rtdb.ref(window.db, `users/${request.uid}`), studentData);
                    await window.rtdb.remove(window.rtdb.ref(window.db, `requests/${request.id}`));
                    
                    showNotification('ØªÙ… Ù‚Ø¨ÙˆÙ„ Ø§Ù„Ø·Ø§Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­ âœ…');
                } catch (error) {
                    console.error("Approval Error:", error);
                    showNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©', 'error');
                }
            };

            const rejectStudent = async (requestId) => {
                if (!isSuperAdmin) {
                    showNotification('ØºÙŠØ± Ù…ØµØ±Ø­ Ù„Ùƒ Ø¨Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡', 'error');
                    return;
                }
                await window.rtdb.remove(window.rtdb.ref(window.db, `requests/${requestId}`));
                showNotification('ØªÙ… Ø±ÙØ¶ Ø§Ù„Ø·Ù„Ø¨');
            };

            const uploadItem = async (collection, data) => {
                await window.rtdb.push(window.rtdb.ref(window.db, collection), {
                    ...data,
                    date: new Date().toLocaleDateString('ar-EG'),
                    ts: Date.now()
                });
                showNotification('ØªÙ… Ø§Ù„Ù†Ø´Ø± Ø¨Ù†Ø¬Ø§Ø­ âœ…');
            };

            const updateStudent = async (id, data) => {
                await window.rtdb.update(window.rtdb.ref(window.db, `users/${id}`), data);
                showNotification('ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ« ğŸ‘Œ');
            };

            const addCourse = async (courseData) => {
                if (!isSuperAdmin) return;
                await window.rtdb.push(window.rtdb.ref(window.db, 'courses'), {
                    ...courseData,
                    ts: Date.now()
                });
                showNotification('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙƒÙˆØ±Ø³ Ø¨Ù†Ø¬Ø§Ø­ âœ…');
            };

            const deleteCourse = async (courseId) => {
                if (!isSuperAdmin) return;
                if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„ÙƒÙˆØ±Ø³ØŸ')) {
                    await window.rtdb.remove(window.rtdb.ref(window.db, `courses/${courseId}`));
                    showNotification('ØªÙ… Ø­Ø°Ù Ø§Ù„ÙƒÙˆØ±Ø³');
                }
            };

            const addExam = async (examData) => {
                if (!isSuperAdmin) return;
                await window.rtdb.push(window.rtdb.ref(window.db, 'exams'), examData);
                showNotification('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø§Ù…ØªØ­Ø§Ù† Ø¨Ù†Ø¬Ø§Ø­');
            };

            const markDailyAttendance = async (studentId, date, status) => {
                await window.rtdb.update(window.rtdb.ref(window.db, `attendance/${studentId}/${date}`), {
                    status, timestamp: Date.now()
                });
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†Ù‚Ø§Ø·
                const student = dataState.students.find(s => s.id === studentId);
                const currentPoints = student?.points || 0;
                await window.rtdb.update(window.rtdb.ref(window.db, `users/${studentId}`), {
                    points: currentPoints + 5
                });
                
                showNotification('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø­Ø¶ÙˆØ±Ùƒ Ø¨Ù†Ø¬Ø§Ø­! +5 Ù†Ù‚Ø§Ø·', 'success');
            };

            const submitExam = async (examId, answers) => {
                if (!user) return;
                
                const exam = dataState.exams.find(e => e.id === examId);
                if (!exam) return;
                
                let score = 0;
                let total = 0;
                
                if (exam.questions) {
                    exam.questions.forEach((q, index) => {
                        if (q.type === 'mcq') {
                            total++;
                            if (answers[index] == q.correctAnswer) {
                                score++;
                            }
                        } else if (q.type === 'essay') {
                            total++;
                            if (answers[index] && answers[index].trim()) {
                                score++; // Ø§Ù„Ù…Ù‚Ø§Ù„ÙŠ Ù†Ø­ØªØ³Ø¨Ù‡Ø§ ÙƒØ§Ù…Ù„Ø© Ø¥Ø°Ø§ ÙƒØªØ¨ Ø¥Ø¬Ø§Ø¨Ø©
                            }
                        }
                    });
                }
                
                const result = {
                    studentId: user.uid,
                    studentName: user.name,
                    examId,
                    examTitle: exam.title,
                    answers,
                    score,
                    total,
                    percentage: total > 0 ? (score / total) * 100 : 0,
                    submittedAt: Date.now()
                };
                
                await window.rtdb.push(window.rtdb.ref(window.db, 'examResults'), result);
                setExamResult(result);
                showNotification('ØªÙ… ØªÙ‚Ø¯ÙŠÙ… Ø§Ù„Ø§Ù…ØªØ­Ø§Ù† Ø¨Ù†Ø¬Ø§Ø­');
            };

            // ================ ØµÙØ­Ø© Ø§Ù„Ù‡Ø¨ÙˆØ· ================
            if (view === 'landing') return (
                <div className="min-h-screen bg-[#1a1a1a] text-white relative overflow-hidden">
                    <div className="absolute inset-0 bg-gradient-to-b from-[#8b0000]/20 to-transparent"></div>

                    <header className="absolute top-0 left-0 right-0 z-50 p-4 md:p-6">
                        <div className="flex justify-between items-center gap-4">
                            <div className="flex items-center gap-3">
                                <div className="w-10 h-10 md:w-12 md:h-12 bg-[#8b0000] rounded-xl flex items-center justify-center border border-[#d4af37]/30 shadow-xl">
                                    <span className="text-xl md:text-2xl text-[#d4af37]">â™</span>
                                </div>
                                <h1 className="text-lg md:text-2xl font-black text-white tracking-tight">
                                    {PLATFORM_NAME}
                                </h1>
                            </div>

                            <div className="flex items-center gap-2 md:gap-4">
                                {user ? (
                                    <button 
                                        onClick={() => setView(userType === 'admin' ? 'admin' : 'student')} 
                                        className="bg-[#2e7d32] hover:bg-[#3e9142] text-white px-6 py-2 rounded-full font-bold transition flex items-center gap-2 shadow-lg"
                                    >
                                        <Icon name="arrow-left" size={18} /> Ø§Ù„Ø¹ÙˆØ¯Ø© Ø¥Ù„Ù‰ ØµÙØ­ØªÙƒ
                                    </button>
                                ) : (
                                    <button 
                                        onClick={() => setShowLoginModal(true)} 
                                        className="bg-[#d4af37] text-[#1a1a1a] hover:bg-[#e5c158] px-6 py-2 rounded-full font-bold transition flex items-center gap-2 shadow-lg"
                                    >
                                        <Icon name="log-in" size={18} /> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
                                    </button>
                                )}
                            </div>
                        </div>
                    </header>

                    <AuthModal 
                        isOpen={showLoginModal}
                        onClose={() => setShowLoginModal(false)}
                        onGoogleLogin={handleGoogleLogin}
                        onPhoneLogin={handlePhoneLogin}
                    />

                    {showPhoneLogin && (
                        <PhoneLoginModal
                            onClose={() => setShowPhoneLogin(false)}
                            onLoginSuccess={(user) => {
                                console.log("Phone login successful", user);
                            }}
                        />
                    )}

                    <div className="container mx-auto px-4 pt-32 pb-16 flex flex-col items-center text-center relative z-10">
                        <h1 className="text-4xl md:text-6xl font-black mb-4">
                            <span className="text-[#d4af37]">{PLATFORM_NAME}</span>
                        </h1>
                        <p className="text-xl md:text-2xl mb-2">Ù…Ø¹ {TEACHER_NAME}</p>
                        <p className="text-[#d4af37] text-lg mb-8">{TEACHER_TITLE}</p>
                        <p className="text-gray-300 text-lg max-w-2xl mb-8">
                            Ø£Ù‚ÙˆÙ‰ Ù…Ù†ØµØ© Ù„ØªØ¹Ù„ÙŠÙ… Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© ÙˆØ§Ù„Ù†Ø­Ùˆ ÙˆØ§Ù„Ø¨Ù„Ø§ØºØ© ÙˆØ§Ù„Ø£Ø¯Ø¨
                        </p>
                        <button 
                            onClick={() => setShowLoginModal(true)}
                            className="bg-[#d4af37] text-[#1a1a1a] px-8 py-3 rounded-lg font-bold text-lg hover:scale-105 transition"
                        >
                            Ø§Ø¨Ø¯Ø£ Ø±Ø­Ù„ØªÙƒ Ø§Ù„Ø¢Ù†
                        </button>
                    </div>

                    <section className="py-16 px-4 relative z-10">
                        <div className="container mx-auto max-w-6xl">
                            <CoursesCatalog courses={dataState.courses} onSelect={(course) => setSelectedCourse(course)} />
                        </div>
                    </section>

                    {selectedCourse && (
                        <CoursePurchaseModal 
                            course={selectedCourse} 
                            onClose={() => setSelectedCourse(null)} 
                            teacherNumber={CONTACT_INFO.vodafoneNumber} 
                            user={user}
                            onRequireLogin={() => {
                                setSelectedCourse(null);
                                showNotification('ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹', 'info');
                                setShowLoginModal(true);
                            }}
                        />
                    )}
                </div>
            );

            // ================ Ø§Ø³ØªÙƒÙ…Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ================
            if (view === 'complete-profile') return (
                <div className="min-h-screen bg-[#1a1a1a] flex items-center justify-center p-4">
                    <div className="glass-panel p-8 w-full max-w-2xl animate-slide-up border-t-4 border-[#d4af37]">
                        <div className="text-center mb-8">
                            <img src={user?.photo || 'https://via.placeholder.com/150'} className="w-20 h-20 rounded-full mx-auto mb-4 border-4 border-[#d4af37]" />
                            <h2 className="text-3xl font-bold text-white mb-2">Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙŠØ§ Ø¨Ø·Ù„! ğŸ‘‹</h2>
                            <p className="text-slate-400">Ø§Ø³ØªÙƒÙ…Ù„ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ø¨Ø¯Ù‚Ø© Ø¹Ø´Ø§Ù† Ø·Ù„Ø¨Ùƒ ÙŠÙˆØµÙ„ Ù„Ù„Ø¥Ø¯Ø§Ø±Ø©</p>
                        </div>

                        <div className="space-y-4">
                            <div className="grid md:grid-cols-3 gap-4">
                                <input className="w-full p-4 bg-white/5 border border-white/10 rounded-xl outline-none text-white text-center" 
                                    placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø£ÙˆÙ„"
                                    value={regData.firstName}
                                    onChange={e => setRegData({ ...regData, firstName: e.target.value })} 
                                />
                                <input className="w-full p-4 bg-white/5 border border-white/10 rounded-xl outline-none text-white text-center" 
                                    placeholder="Ø§Ø³Ù… Ø§Ù„Ø£Ø¨"
                                    value={regData.fatherName}
                                    onChange={e => setRegData({ ...regData, fatherName: e.target.value })} 
                                />
                                <input className="w-full p-4 bg-white/5 border border-white/10 rounded-xl outline-none text-white text-center" 
                                    placeholder="Ø§Ø³Ù… Ø§Ù„Ø¬Ø¯"
                                    value={regData.grandfatherName}
                                    onChange={e => setRegData({ ...regData, grandfatherName: e.target.value })} 
                                />
                            </div>

                            <div className="grid md:grid-cols-2 gap-4">
                                <input className="w-full p-4 bg-white/5 border border-white/10 rounded-xl outline-none text-white" 
                                    placeholder="Ø±Ù‚Ù… Ù‡Ø§ØªÙÙƒ (11 Ø±Ù‚Ù…)" 
                                    maxLength="11"
                                    value={regData.phone}
                                    onChange={e => setRegData({ ...regData, phone: e.target.value })} 
                                />
                                <input className="w-full p-4 bg-white/5 border border-white/10 rounded-xl outline-none text-white" 
                                    placeholder="Ø±Ù‚Ù… ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø±" 
                                    maxLength="11"
                                    value={regData.parentPhone}
                                    onChange={e => setRegData({ ...regData, parentPhone: e.target.value })} 
                                />
                            </div>

                            <input className="w-full p-4 bg-white/5 border border-white/10 rounded-xl outline-none text-white" 
                                placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø¯Ø±Ø³Ø© ğŸ«" 
                                value={regData.school}
                                onChange={e => setRegData({ ...regData, school: e.target.value })} 
                            />

                            <div className="grid md:grid-cols-2 gap-4">
                                <input className="w-full p-4 bg-white/5 border border-white/10 rounded-xl outline-none text-white" 
                                    placeholder="Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø© ğŸ—ºï¸" 
                                    value={regData.governorate}
                                    onChange={e => setRegData({ ...regData, governorate: e.target.value })} 
                                />
                                <input className="w-full p-4 bg-white/5 border border-white/10 rounded-xl outline-none text-white" 
                                    placeholder="Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© ğŸ“" 
                                    value={regData.city}
                                    onChange={e => setRegData({ ...regData, city: e.target.value })} 
                                />
                            </div>

                            <select className="w-full p-4 bg-black/30 border border-white/10 rounded-xl outline-none text-white" 
                                onChange={e => setRegData({ ...regData, grade: e.target.value })} value={regData.grade}>
                                <option value="1sec">Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ</option>
                                <option value="2sec">Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù†ÙŠ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ</option>
                                <option value="3sec">Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù„Ø« Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ</option>
                            </select>

                            <textarea
                                placeholder="Ù†Ø¨Ø°Ø© Ø¹Ù†Ùƒ (Ø¥Ø¬Ø¨Ø§Ø±ÙŠ)"
                                className="w-full p-4 bg-white/5 border border-white/10 rounded-xl outline-none text-white h-24"
                                value={regData.bio}
                                onChange={e => setRegData({ ...regData, bio: e.target.value })}
                            />

                            <button 
                                onClick={handleStudentRegistration}
                                className="btn-primary w-full py-4 rounded-xl text-lg font-bold flex items-center justify-center gap-2 hover:scale-105 transition"
                            >
                                <Icon name="send" /> Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨
                            </button>
                        </div>
                    </div>
                </div>
            );

            // ================ Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© ================
            if (view === 'waiting-approval') return (
                <div className="min-h-screen bg-[#1a1a1a] flex items-center justify-center p-4">
                    <div className="glass-panel p-6 md:p-10 max-w-lg w-full text-center animate-slide-up border-t-4 border-[#d4af37] space-y-6">
                        <div className="w-16 h-16 md:w-20 md:h-20 bg-[#d4af37]/20 rounded-full flex items-center justify-center mx-auto animate-pulse">
                            <span className="text-4xl md:text-5xl text-[#d4af37]">â™</span>
                        </div>

                        <h2 className="text-2xl md:text-3xl font-black text-white">Ø§Ù„Ø­Ø³Ø§Ø¨ Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© â³</h2>

                        <div className="bg-[#d4af37]/10 border border-[#d4af37]/30 rounded-xl p-4 md:p-6">
                            <p className="text-slate-200 leading-relaxed text-base md:text-lg font-bold">
                                â™ ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ø¨Ù†Ø¬Ø§Ø­!
                            </p>
                            <p className="text-slate-300 leading-relaxed text-sm md:text-base mt-2">
                                Ø­Ø³Ø§Ø¨Ùƒ Ø§Ù„Ø¢Ù† Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© Ù…Ù† Ù‚Ø¨Ù„ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©.
                                <br />
                                Ø³ÙŠØªÙ… ØªÙØ¹ÙŠÙ„ Ø­Ø³Ø§Ø¨Ùƒ Ø®Ù„Ø§Ù„ <span className="text-[#d4af37] font-bold">Ø³Ø§Ø¹Ø§Øª Ù‚Ù„ÙŠÙ„Ø©</span>.
                            </p>
                        </div>

                        <div className="flex flex-col gap-3">
                            <button
                                onClick={() => window.location.reload()}
                                className="bg-[#d4af37]/20 hover:bg-[#d4af37]/30 text-[#d4af37] px-6 py-3 rounded-xl font-bold transition flex items-center justify-center gap-2"
                            >
                                <Icon name="refresh-cw" size={18} />
                                Ø§Ø¶ØºØ· Ù‡Ù†Ø§ Ù„Ù„ØªØ­Ø¯ÙŠØ«
                            </button>
                            <button
                                onClick={handleLogout}
                                className="bg-red-500/10 hover:bg-red-500/20 text-red-400 px-6 py-3 rounded-xl font-bold transition"
                            >
                                ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬
                            </button>
                        </div>
                    </div>
                </div>
            );

            // ================ ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø·Ø§Ù„Ø¨ ================
            if (view === 'student') {
                const filteredLectures = getFilteredLectures();
                const filteredWhiteboards = getFilteredWhiteboards();
                const filteredExams = getFilteredExams();
                const studentResults = getStudentResults();
                const paidCourses = dataState.courses.filter(c => enrolledCourses.includes(c.id));

                return (
                    <div className="min-h-screen bg-[#1a1a1a] text-white flex flex-col md:flex-row">
                        {/* Ø§Ù„Ø³Ø§ÙŠØ¯ Ø¨Ø§Ø± */}
                        <aside className={`fixed inset-y-0 right-0 z-50 w-64 bg-[#2a2a2a] border-l border-[#d4af37]/20 flex flex-col transition-transform duration-300 ${sidebarOpen ? 'translate-x-0' : 'translate-x-full'} md:translate-x-0 md:static`}>
                            <div className="p-6 text-center border-b border-[#d4af37]/20">
                                <img src={user?.photo} className="w-20 h-20 rounded-full border-4 border-[#d4af37] mx-auto mb-3" />
                                <h3 className="font-bold text-lg">{user?.name}</h3>
                                <p className="text-xs text-slate-400 font-mono mt-1">{user?.code}</p>
                                <span className={`inline-block mt-2 px-2 py-1 rounded text-xs grade-badge-${user?.grade}`}>
                                    {user?.grade === '1sec' ? 'Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„' : user?.grade === '2sec' ? 'Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù†ÙŠ' : 'Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù„Ø«'}
                                </span>
                            </div>

                            <nav className="p-4 space-y-2 flex-1">
                                {[
                                    { id: 'home', label: 'Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©', icon: 'home' },
                                    { id: 'courses', label: 'ÙƒÙˆØ±Ø³Ø§ØªÙŠ', icon: 'book-open' },
                                    { id: 'lectures', label: 'Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª', icon: 'play-circle' },
                                    { id: 'whiteboards', label: 'Ø§Ù„Ø³Ø¨ÙˆØ±Ø§Øª', icon: 'image' },
                                    { id: 'exams', label: 'Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†Ø§Øª', icon: 'clipboard-list' },
                                    { id: 'results', label: 'Ù†ØªØ§Ø¦Ø¬ÙŠ', icon: 'award' },
                                    { id: 'attendance', label: 'Ø§Ù„Ø­Ø¶ÙˆØ±', icon: 'calendar-check' },
                                ].map(item => (
                                    <button key={item.id} onClick={() => { setActiveTab(item.id); setSelectedLecture(null); setSelectedExam(null); setSidebarOpen(false); }}
                                        className={`w-full flex items-center gap-3 p-3 rounded-xl transition font-bold ${activeTab === item.id ? 'bg-[#8b0000] text-white' : 'text-slate-400 hover:bg-white/5'}`}>
                                        <Icon name={item.icon} size={18} /> {item.label}
                                    </button>
                                ))}
                            </nav>

                            <div className="p-4 border-t border-[#d4af37]/20">
                                <button onClick={handleLogout} className="flex items-center justify-center gap-2 text-red-400 w-full p-3 hover:bg-red-500/10 rounded-xl font-bold">
                                    <Icon name="log-out" size={18} /> Ø®Ø±ÙˆØ¬
                                </button>
                            </div>
                        </aside>

                        {/* Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ */}
                        <main className="flex-1 p-4 md:p-6 overflow-y-auto">
                            {/* ÙÙ„ØªØ± Ø§Ù„ØµÙÙˆÙ */}
                            <div className="flex gap-2 mb-6 overflow-x-auto pb-2">
                                <button onClick={() => setGradeFilter('all')}
                                    className={`px-4 py-2 rounded-lg font-bold whitespace-nowrap ${gradeFilter === 'all' ? 'bg-[#d4af37] text-[#1a1a1a]' : 'bg-white/10'}`}>
                                    Ø§Ù„ÙƒÙ„
                                </button>
                                <button onClick={() => setGradeFilter('1sec')}
                                    className={`px-4 py-2 rounded-lg font-bold whitespace-nowrap grade-badge-1sec ${gradeFilter === '1sec' ? 'ring-2 ring-[#d4af37]' : ''}`}>
                                    Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„
                                </button>
                                <button onClick={() => setGradeFilter('2sec')}
                                    className={`px-4 py-2 rounded-lg font-bold whitespace-nowrap grade-badge-2sec ${gradeFilter === '2sec' ? 'ring-2 ring-[#d4af37]' : ''}`}>
                                    Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù†ÙŠ
                                </button>
                                <button onClick={() => setGradeFilter('3sec')}
                                    className={`px-4 py-2 rounded-lg font-bold whitespace-nowrap grade-badge-3sec ${gradeFilter === '3sec' ? 'ring-2 ring-[#d4af37]' : ''}`}>
                                    Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù„Ø«
                                </button>
                            </div>

                            {/* Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© */}
                            {activeTab === 'home' && (
                                <div className="space-y-6">
                                    <div className="glass-panel p-6">
                                        <h2 className="text-2xl font-bold mb-2">Ù…Ø±Ø­Ø¨Ø§Ù‹ {user?.name}!</h2>
                                        <p className="text-slate-400">Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙÙŠ {PLATFORM_NAME}</p>
                                    </div>

                                    <div className="glass-panel p-6">
                                        <h3 className="text-xl font-bold mb-4 flex items-center gap-2">
                                            <Icon name="book-open" className="text-[#d4af37]" /> ÙƒÙˆØ±Ø³Ø§ØªÙŠ Ø§Ù„Ù…Ø´ØªØ±Ùƒ ÙÙŠÙ‡Ø§
                                        </h3>
                                        {paidCourses.length === 0 ? (
                                            <p className="text-slate-400">Ù„Ù… ØªØ´ØªØ±Ùƒ ÙÙŠ Ø£ÙŠ ÙƒÙˆØ±Ø³ Ø¨Ø¹Ø¯</p>
                                        ) : (
                                            <div className="grid md:grid-cols-2 gap-4">
                                                {paidCourses.map(course => (
                                                    <div key={course.id} className="bg-white/5 p-4 rounded-lg border border-[#d4af37]/20">
                                                        <h4 className="font-bold">{course.title}</h4>
                                                        <p className="text-sm text-slate-400 mt-2 line-clamp-2">{course.description}</p>
                                                        <span className={`inline-block mt-2 px-2 py-1 rounded text-xs grade-badge-${course.grade}`}>
                                                            {course.grade === '1sec' ? 'Ø£ÙˆÙ„Ù‰' : course.grade === '2sec' ? 'ØªØ§Ù†ÙŠØ©' : 'ØªØ§Ù„ØªØ©'}
                                                        </span>
                                                    </div>
                                                ))}
                                            </div>
                                        )}
                                    </div>

                                    <HonorBoard students={dataState.students} />
                                </div>
                            )}

                            {/* ÙƒÙˆØ±Ø³Ø§ØªÙŠ */}
                            {activeTab === 'courses' && (
                                <div className="space-y-6">
                                    <h2 className="text-2xl font-bold">ÙƒÙˆØ±Ø³Ø§ØªÙŠ Ø§Ù„Ù…Ø´ØªØ±Ùƒ ÙÙŠÙ‡Ø§</h2>
                                    
                                    {paidCourses.length === 0 ? (
                                        <div className="glass-panel p-12 text-center">
                                            <Icon name="book-open" size={48} className="mx-auto mb-4 text-gray-500" />
                                            <p className="text-gray-400">Ù„Ù… ØªØ´ØªØ±Ùƒ ÙÙŠ Ø£ÙŠ ÙƒÙˆØ±Ø³ Ø¨Ø¹Ø¯</p>
                                        </div>
                                    ) : (
                                        <div className="grid md:grid-cols-2 gap-6">
                                            {paidCourses.map(course => (
                                                <div key={course.id} className="glass-panel overflow-hidden">
                                                    <div className="h-32 bg-[#8b0000]/20 p-4">
                                                        <h3 className="font-bold text-lg">{course.title}</h3>
                                                        <p className="text-sm text-slate-400 mt-2 line-clamp-2">{course.description}</p>
                                                    </div>
                                                    <div className="p-4 flex justify-between items-center">
                                                        <span className={`px-2 py-1 rounded text-xs grade-badge-${course.grade}`}>
                                                            {course.grade === '1sec' ? 'Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„' : course.grade === '2sec' ? 'Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù†ÙŠ' : 'Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù„Ø«'}
                                                        </span>
                                                        <button 
                                                            onClick={() => {
                                                                setActiveTab('lectures');
                                                                setGradeFilter(course.grade);
                                                            }}
                                                            className="text-[#d4af37] hover:underline text-sm"
                                                        >
                                                            Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª
                                                        </button>
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    )}
                                </div>
                            )}

                            {/* Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª */}
                            {activeTab === 'lectures' && !selectedLecture && (
                                <div className="space-y-6">
                                    <h2 className="text-2xl font-bold">Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª</h2>
                                    
                                    {filteredLectures.length === 0 ? (
                                        <div className="glass-panel p-12 text-center">
                                            <Icon name="video-off" size={48} className="mx-auto mb-4 text-gray-500" />
                                            <p className="text-gray-400">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø­Ø§Ø¶Ø±Ø§Øª Ù…ØªØ§Ø­Ø©</p>
                                        </div>
                                    ) : (
                                        <div className="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
                                            {filteredLectures.map(lecture => {
                                                const allowed = isLectureAllowed(user, lecture, enrolledCourses);
                                                const course = dataState.courses.find(c => c.id === lecture.courseId);
                                                
                                                return (
                                                    <div 
                                                        key={lecture.id} 
                                                        className={`glass-panel overflow-hidden relative ${allowed ? 'cursor-pointer hover:scale-105 transition' : ''}`}
                                                        onClick={() => allowed && setSelectedLecture(lecture)}
                                                    >
                                                        {!allowed && (
                                                            <div className="locked-overlay">
                                                                <div className="text-center">
                                                                    <Icon name="lock" size={32} className="mx-auto mb-2 text-[#d4af37]" />
                                                                    <p className="text-sm font-bold">ØºÙŠØ± Ù…Ø´ØªØ±Ùƒ</p>
                                                                </div>
                                                            </div>
                                                        )}
                                                        
                                                        <div className="h-32 bg-[#8b0000]/20 flex items-center justify-center">
                                                            <Icon name="play-circle" size={48} className={allowed ? 'text-[#d4af37]' : 'text-gray-500'} />
                                                        </div>
                                                        
                                                        <div className="p-4">
                                                            <h3 className="font-bold mb-2 line-clamp-1">{lecture.title}</h3>
                                                            <div className="flex justify-between items-center text-xs">
                                                                <span className={`px-2 py-1 rounded grade-badge-${lecture.grade}`}>
                                                                    {lecture.grade === '1sec' ? 'Ø£ÙˆÙ„Ù‰' : lecture.grade === '2sec' ? 'ØªØ§Ù†ÙŠØ©' : 'ØªØ§Ù„ØªØ©'}
                                                                </span>
                                                                {lecture.isFree && (
                                                                    <span className="bg-[#2e7d32] text-white px-2 py-1 rounded">Ù…Ø¬Ø§Ù†ÙŠ</span>
                                                                )}
                                                                {course && (
                                                                    <span className="text-slate-400">{course.title}</span>
                                                                )}
                                                            </div>
                                                        </div>
                                                    </div>
                                                );
                                            })}
                                        </div>
                                    )}
                                </div>
                            )}

                            {/* Ø¹Ø±Ø¶ Ù…Ø­Ø§Ø¶Ø±Ø© Ù…Ø­Ø¯Ø¯Ø© */}
                            {selectedLecture && (
                                <div>
                                    <button onClick={() => setSelectedLecture(null)} className="mb-4 flex items-center gap-2 text-[#d4af37] hover:underline">
                                        <Icon name="arrow-right" /> Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª
                                    </button>
                                    
                                    <div className="glass-panel p-6">
                                        <h2 className="text-2xl font-bold mb-4">{selectedLecture.title}</h2>
                                        
                                        <div className="aspect-video bg-black rounded-lg overflow-hidden mb-4">
                                            {selectedLecture.link.includes('youtube') ? (
                                                <iframe 
                                                    src={selectedLecture.link.replace('watch?v=', 'embed/')} 
                                                    className="w-full h-full"
                                                    allowFullScreen
                                                />
                                            ) : (
                                                <iframe 
                                                    src={selectedLecture.link} 
                                                    className="w-full h-full"
                                                    allowFullScreen
                                                />
                                            )}
                                        </div>
                                        
                                        <p className="text-slate-300 whitespace-pre-wrap">{selectedLecture.description}</p>
                                    </div>
                                </div>
                            )}

                            {/* Ø§Ù„Ø³Ø¨ÙˆØ±Ø§Øª */}
                            {activeTab === 'whiteboards' && (
                                <div className="space-y-6">
                                    <h2 className="text-2xl font-bold">Ø§Ù„Ø³Ø¨ÙˆØ±Ø§Øª</h2>
                                    
                                    {filteredWhiteboards.length === 0 ? (
                                        <div className="glass-panel p-12 text-center">
                                            <Icon name="image-off" size={48} className="mx-auto mb-4 text-gray-500" />
                                            <p className="text-gray-400">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³Ø¨ÙˆØ±Ø§Øª Ù…ØªØ§Ø­Ø© Ù„ØµÙÙƒ</p>
                                        </div>
                                    ) : (
                                        <div className="grid md:grid-cols-3 gap-6">
                                            {filteredWhiteboards.map(wb => (
                                                <a 
                                                    key={wb.id}
                                                    href={wb.link}
                                                    target="_blank"
                                                    className="glass-panel overflow-hidden hover:scale-105 transition group"
                                                >
                                                    <div className="h-40 bg-[#8b0000]/20 flex items-center justify-center">
                                                        <Icon name="file-text" size={48} className="group-hover:text-[#d4af37] transition" />
                                                    </div>
                                                    <div className="p-4">
                                                        <h3 className="font-bold mb-2">{wb.title}</h3>
                                                        <span className={`px-2 py-1 rounded text-xs grade-badge-${wb.grade}`}>
                                                            {wb.grade === '1sec' ? 'Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„' : wb.grade === '2sec' ? 'Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù†ÙŠ' : 'Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù„Ø«'}
                                                        </span>
                                                    </div>
                                                </a>
                                            ))}
                                        </div>
                                    )}
                                </div>
                            )}

                            {/* Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†Ø§Øª */}
                            {activeTab === 'exams' && !selectedExam && (
                                <div className="space-y-6">
                                    <h2 className="text-2xl font-bold">Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†Ø§Øª</h2>
                                    
                                    {filteredExams.length === 0 ? (
                                        <div className="glass-panel p-12 text-center">
                                            <Icon name="clipboard-x" size={48} className="mx-auto mb-4 text-gray-500" />
                                            <p className="text-gray-400">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø§Ù…ØªØ­Ø§Ù†Ø§Øª Ù…ØªØ§Ø­Ø©</p>
                                        </div>
                                    ) : (
                                        <div className="grid md:grid-cols-2 gap-6">
                                            {filteredExams.map(exam => {
                                                const alreadySubmitted = dataState.examResults.some(r => r.examId === exam.id && r.studentId === user.uid);
                                                
                                                return (
                                                    <div key={exam.id} className="glass-panel p-6">
                                                        <h3 className="font-bold text-lg mb-2">{exam.title}</h3>
                                                        <p className="text-slate-400 text-sm mb-4 line-clamp-2">{exam.question}</p>
                                                        
                                                        <div className="flex justify-between items-center">
                                                            <span className={`px-2 py-1 rounded text-xs grade-badge-${exam.grade}`}>
                                                                {exam.grade === '1sec' ? 'Ø£ÙˆÙ„Ù‰' : exam.grade === '2sec' ? 'ØªØ§Ù†ÙŠØ©' : 'ØªØ§Ù„ØªØ©'}
                                                            </span>
                                                            
                                                            {alreadySubmitted ? (
                                                                <span className="text-[#2e7d32] flex items-center gap-1">
                                                                    <Icon name="check-circle" size={16} /> ØªÙ… Ø§Ù„ØªÙ‚Ø¯ÙŠÙ…
                                                                </span>
                                                            ) : (
                                                                <button 
                                                                    onClick={() => setSelectedExam(exam)}
                                                                    className="bg-[#8b0000] text-white px-4 py-2 rounded-lg text-sm font-bold"
                                                                >
                                                                    Ø¨Ø¯Ø¡ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†
                                                                </button>
                                                            )}
                                                        </div>
                                                    </div>
                                                );
                                            })}
                                        </div>
                                    )}
                                </div>
                            )}

                            {/* Ø¹Ø±Ø¶ Ø§Ù…ØªØ­Ø§Ù† Ù…Ø­Ø¯Ø¯ */}
                            {selectedExam && !examResult && (
                                <div>
                                    <button onClick={() => setSelectedExam(null)} className="mb-4 flex items-center gap-2 text-[#d4af37] hover:underline">
                                        <Icon name="arrow-right" /> Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø§Ù…ØªØ­Ø§Ù†Ø§Øª
                                    </button>
                                    
                                    <div className="glass-panel p-6">
                                        <h2 className="text-2xl font-bold mb-2">{selectedExam.title}</h2>
                                        <p className="text-slate-400 mb-6">{selectedExam.question}</p>
                                        
                                        {selectedExam.type === 'mcq' && selectedExam.options && (
                                            <div className="space-y-3">
                                                {selectedExam.options.map((opt, index) => (
                                                    <label key={index} className="flex items-center gap-3 p-3 hover:bg-white/5 rounded cursor-pointer border border-white/10">
                                                        <input 
                                                            type="radio" 
                                                            name="answer"
                                                            value={index}
                                                            onChange={(e) => setExamAnswers({ answer: parseInt(e.target.value) })}
                                                            className="w-4 h-4 accent-[#2e7d32]"
                                                        />
                                                        <span>{opt}</span>
                                                    </label>
                                                ))}
                                            </div>
                                        )}

                                        {selectedExam.type === 'essay' && (
                                            <textarea 
                                                className="w-full bg-white/5 border border-white/10 p-4 rounded-lg h-32"
                                                placeholder="Ø§ÙƒØªØ¨ Ø¥Ø¬Ø§Ø¨ØªÙƒ Ù‡Ù†Ø§..."
                                                onChange={(e) => setExamAnswers({ answer: e.target.value })}
                                            />
                                        )}

                                        <button 
                                            onClick={() => {
                                                // ØªØ¨Ø³ÙŠØ·: Ù†Ø¹ØªØ¨Ø± Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø© Ù„Ùˆ Ø§Ø®ØªØ§Ø± Ø£Ùˆ ÙƒØªØ¨ Ø­Ø§Ø¬Ø©
                                                const score = examAnswers.answer !== undefined && examAnswers.answer !== '' ? 1 : 0;
                                                const result = {
                                                    studentId: user.uid,
                                                    studentName: user.name,
                                                    examId: selectedExam.id,
                                                    examTitle: selectedExam.title,
                                                    answers: examAnswers,
                                                    score: score,
                                                    total: 1,
                                                    percentage: score * 100,
                                                    submittedAt: Date.now()
                                                };
                                                window.rtdb.push(window.rtdb.ref(window.db, 'examResults'), result);
                                                setExamResult(result);
                                                showNotification('ØªÙ… ØªÙ‚Ø¯ÙŠÙ… Ø§Ù„Ø§Ù…ØªØ­Ø§Ù† Ø¨Ù†Ø¬Ø§Ø­');
                                            }}
                                            className="w-full bg-[#2e7d32] text-white p-4 rounded-lg font-bold mt-6 hover:bg-[#3e9142]"
                                        >
                                            ØªÙ‚Ø¯ÙŠÙ… Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†
                                        </button>
                                    </div>
                                </div>
                            )}

                            {/* Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø§Ù…ØªØ­Ø§Ù† */}
                            {examResult && (
                                <div className="glass-panel p-8 text-center">
                                    <h2 className="text-2xl font-bold mb-4">Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†</h2>
                                    <div className="w-32 h-32 rounded-full bg-[#2e7d32]/20 flex items-center justify-center mx-auto mb-4">
                                        <span className="text-4xl font-black text-[#d4af37]">{Math.round(examResult.percentage)}%</span>
                                    </div>
                                    <p className="text-xl mb-2">Ø§Ù„Ø¯Ø±Ø¬Ø©: {examResult.score} / {examResult.total}</p>
                                    <button onClick={() => { setSelectedExam(null); setExamResult(null); setActiveTab('results'); }} 
                                        className="bg-[#8b0000] text-white px-6 py-2 rounded-lg mt-4">
                                        Ø¹Ø±Ø¶ Ù†ØªØ§Ø¦Ø¬ÙŠ
                                    </button>
                                </div>
                            )}

                            {/* Ù†ØªØ§Ø¦Ø¬ÙŠ */}
                            {activeTab === 'results' && (
                                <ResultsPage results={studentResults} students={dataState.students} />
                            )}

                            {/* Ø§Ù„Ø­Ø¶ÙˆØ± */}
                            {activeTab === 'attendance' && (
                                <EnhancedAttendanceTracker 
                                    attendance={dataState.attendance} 
                                    studentId={user?.uid} 
                                    onMarkAttendance={markDailyAttendance}
                                />
                            )}
                        </main>
                    </div>
                );
            }

            // ================ ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø£Ø¯Ù…Ù† ================
            if (view === 'admin') {
                const [adminTab, setAdminTab] = useState('dashboard');
                const [newCourse, setNewCourse] = useState({ title: '', description: '', price: '', grade: '1sec', image: '', duration: '30' });
                const [newLecture, setNewLecture] = useState({ title: '', description: '', link: '', grade: '1sec', courseId: '', isFree: false });
                const [newWhiteboard, setNewWhiteboard] = useState({ title: '', link: '', grade: '1sec' });

                const filteredStudents = dataState.students.filter(s => {
                    if (searchQuery && !s.name?.toLowerCase().includes(searchQuery.toLowerCase()) && !s.email?.toLowerCase().includes(searchQuery.toLowerCase())) return false;
                    return !['admin', 'boss'].includes(s.role);
                });

                return (
                    <div className="min-h-screen bg-[#1a1a1a] text-white flex">
                        {/* Ø³Ø§ÙŠØ¯ Ø¨Ø§Ø± Ø§Ù„Ø£Ø¯Ù…Ù† */}
                        <aside className="w-64 bg-[#2a2a2a] border-l border-[#d4af37]/20 min-h-screen">
                            <div className="p-4 border-b border-[#d4af37]/20">
                                <h2 className="text-xl font-bold text-[#d4af37]">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h2>
                                <p className="text-xs text-slate-400 mt-1">{TEACHER_NAME}</p>
                            </div>
                            
                            <nav className="p-4 space-y-2">
                                {[
                                    { id: 'dashboard', label: 'Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª', icon: 'home' },
                                    { id: 'requests', label: 'Ø·Ù„Ø¨Ø§Øª Ø§Ù„ØªØ³Ø¬ÙŠÙ„', icon: 'user-plus', badge: dataState.requests.length },
                                    { id: 'students', label: 'Ø§Ù„Ø·Ù„Ø§Ø¨', icon: 'users' },
                                    { id: 'subscriptions', label: 'Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª', icon: 'credit-card' },
                                    { id: 'courses', label: 'Ø§Ù„ÙƒÙˆØ±Ø³Ø§Øª', icon: 'book-open' },
                                    { id: 'lectures', label: 'Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª', icon: 'video' },
                                    { id: 'whiteboards', label: 'Ø§Ù„Ø³Ø¨ÙˆØ±Ø§Øª', icon: 'image' },
                                    { id: 'exams', label: 'Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†Ø§Øª', icon: 'clipboard-list' },
                                    { id: 'results', label: 'Ø§Ù„Ù†ØªØ§Ø¦Ø¬', icon: 'award' },
                                ].map(item => (
                                    <button key={item.id} onClick={() => setAdminTab(item.id)}
                                        className={`w-full flex items-center gap-3 p-3 rounded-lg transition ${adminTab === item.id ? 'bg-[#8b0000] text-white' : 'hover:bg-white/5 text-slate-300'}`}>
                                        <Icon name={item.icon} size={18} />
                                        {item.label}
                                        {item.badge > 0 && (
                                            <span className="bg-[#d4af37] text-[#1a1a1a] text-xs px-2 py-0.5 rounded-full mr-auto">{item.badge}</span>
                                        )}
                                    </button>
                                ))}
                            </nav>
                            
                            <div className="p-4 border-t border-[#d4af37]/20">
                                <button onClick={handleLogout} className="w-full flex items-center gap-2 text-red-400 hover:bg-red-500/10 p-2 rounded-lg">
                                    <Icon name="log-out" size={18} /> ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬
                                </button>
                            </div>
                        </aside>

                        {/* Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø£Ø¯Ù…Ù† */}
                        <main className="flex-1 p-6 overflow-y-auto">
                            {/* Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª */}
                            {adminTab === 'dashboard' && (
                                <div>
                                    <h2 className="text-2xl font-bold mb-6">Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</h2>
                                    <div className="grid md:grid-cols-4 gap-6">
                                        <div className="glass-panel p-6">
                                            <Icon name="users" size={24} className="text-[#d4af37] mb-2" />
                                            <p className="text-3xl font-bold">{dataState.students.filter(s => !['admin', 'boss'].includes(s.role)).length}</p>
                                            <p className="text-slate-400">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø·Ù„Ø§Ø¨</p>
                                        </div>
                                        <div className="glass-panel p-6">
                                            <Icon name="book-open" size={24} className="text-[#d4af37] mb-2" />
                                            <p className="text-3xl font-bold">{dataState.courses.length}</p>
                                            <p className="text-slate-400">Ø§Ù„ÙƒÙˆØ±Ø³Ø§Øª</p>
                                        </div>
                                        <div className="glass-panel p-6">
                                            <Icon name="video" size={24} className="text-[#d4af37] mb-2" />
                                            <p className="text-3xl font-bold">{dataState.lectures.length}</p>
                                            <p className="text-slate-400">Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª</p>
                                        </div>
                                        <div className="glass-panel p-6">
                                            <Icon name="clipboard-list" size={24} className="text-[#d4af37] mb-2" />
                                            <p className="text-3xl font-bold">{dataState.exams.length}</p>
                                            <p className="text-slate-400">Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†Ø§Øª</p>
                                        </div>
                                    </div>
                                </div>
                            )}

                            {/* Ø·Ù„Ø¨Ø§Øª Ø§Ù„ØªØ³Ø¬ÙŠÙ„ */}
                            {adminTab === 'requests' && (
                                <div>
                                    <h2 className="text-2xl font-bold mb-6">Ø·Ù„Ø¨Ø§Øª Ø§Ù„ØªØ³Ø¬ÙŠÙ„</h2>
                                    {dataState.requests.length === 0 ? (
                                        <div className="glass-panel p-12 text-center">
                                            <Icon name="inbox" size={48} className="mx-auto mb-4 text-gray-500" />
                                            <p className="text-slate-400">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©</p>
                                        </div>
                                    ) : (
                                        <div className="space-y-4">
                                            {dataState.requests.map(req => (
                                                <div key={req.id} className="glass-panel p-6">
                                                    <div className="flex items-start gap-4">
                                                        <img src={req.photo} className="w-16 h-16 rounded-full border-2 border-[#d4af37]" />
                                                        <div className="flex-1">
                                                            <h3 className="font-bold text-lg">{req.name}</h3>
                                                            <p className="text-sm text-slate-400 mb-2">{req.email}</p>
                                                            <div className="grid md:grid-cols-2 gap-2 text-sm mb-4">
                                                                <p>ğŸ“ {req.phone}</p>
                                                                <p>ğŸ‘¨â€ğŸ‘©â€ğŸ‘¦ {req.parentPhone}</p>
                                                                <p>ğŸ« {req.school}</p>
                                                                <p>ğŸ“ {req.governorate} - {req.city}</p>
                                                                <p className={`px-2 py-1 rounded inline-block grade-badge-${req.grade}`}>
                                                                    {req.grade === '1sec' ? 'Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„' : req.grade === '2sec' ? 'Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù†ÙŠ' : 'Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù„Ø«'}
                                                                </p>
                                                            </div>
                                                            {req.bio && <p className="text-sm bg-white/5 p-2 rounded mb-4">{req.bio}</p>}
                                                            <div className="flex gap-2">
                                                                <button onClick={() => approveStudent(req)} className="bg-[#2e7d32] text-white px-4 py-2 rounded-lg text-sm font-bold">Ù‚Ø¨ÙˆÙ„</button>
                                                                <button onClick={() => rejectStudent(req.id)} className="bg-[#8b0000] text-white px-4 py-2 rounded-lg text-sm font-bold">Ø±ÙØ¶</button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    )}
                                </div>
                            )}

                            {/* Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø§Ø¨ */}
                            {adminTab === 'students' && (
                                <div>
                                    <h2 className="text-2xl font-bold mb-6">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø§Ø¨</h2>
                                    <input placeholder="Ø¨Ø­Ø«..." className="bg-white/5 border border-white/10 px-4 py-2 rounded-xl w-full mb-4"
                                        value={searchQuery} onChange={e => setSearchQuery(e.target.value)} />
                                    <div className="glass-panel overflow-x-auto">
                                        <table className="w-full text-right">
                                            <thead className="bg-[#8b0000]/20">
                                                <tr>
                                                    <th className="p-3">Ø§Ù„Ø·Ø§Ù„Ø¨</th>
                                                    <th className="p-3">Ø§Ù„ØµÙ</th>
                                                    <th className="p-3">Ø§Ù„ÙƒÙˆØ¯</th>
                                                    <th className="p-3">Ø§Ù„ÙƒÙˆØ±Ø³Ø§Øª</th>
                                                    <th className="p-3">Ø§Ù„Ø­Ø§Ù„Ø©</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {filteredStudents.map(student => (
                                                    <tr key={student.id} className="border-b border-gray-700">
                                                        <td className="p-3">
                                                            <div className="flex items-center gap-2">
                                                                <img src={student.photo} className="w-8 h-8 rounded-full" />
                                                                <span>{student.name}</span>
                                                            </div>
                                                        </td>
                                                        <td className="p-3">
                                                            <span className={`px-2 py-1 rounded text-xs grade-badge-${student.grade}`}>
                                                                {student.grade === '1sec' ? 'Ø£ÙˆÙ„Ù‰' : student.grade === '2sec' ? 'ØªØ§Ù†ÙŠØ©' : 'ØªØ§Ù„ØªØ©'}
                                                            </span>
                                                        </td>
                                                        <td className="p-3 font-mono">{student.code}</td>
                                                        <td className="p-3">{(student.enrolledCourses?.length || 0)} ÙƒÙˆØ±Ø³</td>
                                                        <td className="p-3">
                                                            {student.isPaid ? (
                                                                <span className="text-[#2e7d32]">Ù…ÙØ¹Ù„</span>
                                                            ) : (
                                                                <span className="text-slate-400">ØºÙŠØ± Ù…ÙØ¹Ù„</span>
                                                            )}
                                                        </td>
                                                    </tr>
                                                ))}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            )}

                            {/* Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª */}
                            {adminTab === 'subscriptions' && (
                                <SubscriptionManager
                                    students={dataState.students}
                                    courses={dataState.courses}
                                    onConfirmPayment={(id, days) => updateStudent(id, { isPaid: true, subscriptionEnd: new Date(Date.now() + days*24*60*60*1000).toISOString() })}
                                    onDeactivate={(id) => updateStudent(id, { isPaid: false, subscriptionEnd: null })}
                                    isSuperAdmin={isSuperAdmin}
                                />
                            )}

                            {/* Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙƒÙˆØ±Ø³Ø§Øª */}
                            {adminTab === 'courses' && (
                                <div>
                                    <h2 className="text-2xl font-bold mb-6">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙƒÙˆØ±Ø³Ø§Øª</h2>
                                    <div className="glass-panel p-6 mb-8">
                                        <h3 className="text-xl font-bold mb-4">Ø¥Ø¶Ø§ÙØ© ÙƒÙˆØ±Ø³ Ø¬Ø¯ÙŠØ¯</h3>
                                        <div className="space-y-4">
                                            <input placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙƒÙˆØ±Ø³" className="w-full bg-white/5 border border-white/10 p-3 rounded-lg"
                                                value={newCourse.title} onChange={e => setNewCourse({...newCourse, title: e.target.value})} />
                                            <textarea placeholder="ÙˆØµÙ Ø§Ù„ÙƒÙˆØ±Ø³" className="w-full bg-white/5 border border-white/10 p-3 rounded-lg h-24"
                                                value={newCourse.description} onChange={e => setNewCourse({...newCourse, description: e.target.value})} />
                                            <div className="grid md:grid-cols-2 gap-4">
                                                <input placeholder="Ø§Ù„Ø³Ø¹Ø±" type="number" className="bg-white/5 border border-white/10 p-3 rounded-lg"
                                                    value={newCourse.price} onChange={e => setNewCourse({...newCourse, price: e.target.value})} />
                                                <input placeholder="Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø©" className="bg-white/5 border border-white/10 p-3 rounded-lg"
                                                    value={newCourse.image} onChange={e => setNewCourse({...newCourse, image: e.target.value})} />
                                            </div>
                                            <select className="bg-white/5 border border-white/10 p-3 rounded-lg"
                                                value={newCourse.grade} onChange={e => setNewCourse({...newCourse, grade: e.target.value})}>
                                                <option value="1sec">Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„</option>
                                                <option value="2sec">Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù†ÙŠ</option>
                                                <option value="3sec">Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù„Ø«</option>
                                            </select>
                                            <button onClick={() => { if (newCourse.title && newCourse.description && newCourse.price) { addCourse(newCourse); setNewCourse({ title: '', description: '', price: '', grade: '1sec', image: '', duration: '30' }); } }}
                                                className="btn-primary px-6 py-3 rounded-lg font-bold">Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙƒÙˆØ±Ø³</button>
                                        </div>
                                    </div>
                                    <div className="grid md:grid-cols-2 gap-6">
                                        {dataState.courses.map(course => (
                                            <div key={course.id} className="glass-panel p-4">
                                                <h3 className="font-bold text-lg">{course.title}</h3>
                                                <p className="text-sm text-slate-400 mb-2 line-clamp-2">{course.description}</p>
                                                <div className="flex justify-between items-center">
                                                    <span className={`px-2 py-1 rounded text-xs grade-badge-${course.grade}`}>
                                                        {course.grade === '1sec' ? 'Ø£ÙˆÙ„Ù‰' : course.grade === '2sec' ? 'ØªØ§Ù†ÙŠØ©' : 'ØªØ§Ù„ØªØ©'}
                                                    </span>
                                                    <span className="text-[#d4af37] font-bold">{course.price} Ø¬.Ù…</span>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            )}

                            {/* Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª */}
                            {adminTab === 'lectures' && (
                                <div>
                                    <h2 className="text-2xl font-bold mb-6">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª</h2>
                                    <div className="glass-panel p-6 mb-8">
                                        <h3 className="text-xl font-bold mb-4">Ø¥Ø¶Ø§ÙØ© Ù…Ø­Ø§Ø¶Ø±Ø© Ø¬Ø¯ÙŠØ¯Ø©</h3>
                                        <div className="space-y-4">
                                            <input placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø©" className="w-full bg-white/5 border border-white/10 p-3 rounded-lg"
                                                value={newLecture.title} onChange={e => setNewLecture({...newLecture, title: e.target.value})} />
                                            <textarea placeholder="ÙˆØµÙ Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø©" className="w-full bg-white/5 border border-white/10 p-3 rounded-lg h-24"
                                                value={newLecture.description} onChange={e => setNewLecture({...newLecture, description: e.target.value})} />
                                            <input placeholder="Ø±Ø§Ø¨Ø· Ø§Ù„ÙÙŠØ¯ÙŠÙˆ" className="w-full bg-white/5 border border-white/10 p-3 rounded-lg"
                                                value={newLecture.link} onChange={e => setNewLecture({...newLecture, link: e.target.value})} />
                                            <div className="grid md:grid-cols-2 gap-4">
                                                <select className="bg-white/5 border border-white/10 p-3 rounded-lg"
                                                    value={newLecture.grade} onChange={e => setNewLecture({...newLecture, grade: e.target.value})}>
                                                    <option value="1sec">Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„</option>
                                                    <option value="2sec">Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù†ÙŠ</option>
                                                    <option value="3sec">Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù„Ø«</option>
                                                </select>
                                                <select className="bg-white/5 border border-white/10 p-3 rounded-lg"
                                                    value={newLecture.courseId} onChange={e => setNewLecture({...newLecture, courseId: e.target.value})}>
                                                    <option value="">Ø§Ø®ØªØ± Ø§Ù„ÙƒÙˆØ±Ø³</option>
                                                    {dataState.courses.map(course => (
                                                        <option key={course.id} value={course.id}>{course.title}</option>
                                                    ))}
                                                </select>
                                            </div>
                                            <label className="flex items-center gap-2">
                                                <input type="checkbox" checked={newLecture.isFree} onChange={e => setNewLecture({...newLecture, isFree: e.target.checked})} />
                                                <span>Ù…Ø­Ø§Ø¶Ø±Ø© Ù…Ø¬Ø§Ù†ÙŠØ©</span>
                                            </label>
                                            <button onClick={() => { if (newLecture.title && newLecture.link && newLecture.courseId) { uploadItem('lectures', newLecture); setNewLecture({ title: '', description: '', link: '', grade: '1sec', courseId: '', isFree: false }); } }}
                                                className="btn-primary px-6 py-3 rounded-lg font-bold">Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø©</button>
                                        </div>
                                    </div>
                                    <div className="grid md:grid-cols-2 gap-6">
                                        {dataState.lectures.map(lecture => {
                                            const course = dataState.courses.find(c => c.id === lecture.courseId);
                                            return (
                                                <div key={lecture.id} className="glass-panel p-4">
                                                    <h3 className="font-bold">{lecture.title}</h3>
                                                    <p className="text-xs text-slate-400 mb-2 line-clamp-2">{lecture.description}</p>
                                                    <div className="flex justify-between items-center text-xs">
                                                        <span className={`px-2 py-1 rounded grade-badge-${lecture.grade}`}>
                                                            {lecture.grade === '1sec' ? 'Ø£ÙˆÙ„Ù‰' : lecture.grade === '2sec' ? 'ØªØ§Ù†ÙŠØ©' : 'ØªØ§Ù„ØªØ©'}
                                                        </span>
                                                        {course && <span>{course.title}</span>}
                                                        {lecture.isFree && <span className="text-[#2e7d32]">Ù…Ø¬Ø§Ù†ÙŠ</span>}
                                                    </div>
                                                </div>
                                            );
                                        })}
                                    </div>
                                </div>
                            )}

                            {/* Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø³Ø¨ÙˆØ±Ø§Øª */}
                            {adminTab === 'whiteboards' && (
                                <div>
                                    <h2 className="text-2xl font-bold mb-6">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø³Ø¨ÙˆØ±Ø§Øª</h2>
                                    <div className="glass-panel p-6 mb-8">
                                        <h3 className="text-xl font-bold mb-4">Ø¥Ø¶Ø§ÙØ© Ø³Ø¨ÙˆØ±Ø© Ø¬Ø¯ÙŠØ¯Ø©</h3>
                                        <input placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø³Ø¨ÙˆØ±Ø©" className="w-full bg-white/5 border border-white/10 p-3 rounded-lg mb-4"
                                            value={newWhiteboard.title} onChange={e => setNewWhiteboard({...newWhiteboard, title: e.target.value})} />
                                        <input placeholder="Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ù„Ù" className="w-full bg-white/5 border border-white/10 p-3 rounded-lg mb-4"
                                            value={newWhiteboard.link} onChange={e => setNewWhiteboard({...newWhiteboard, link: e.target.value})} />
                                        <select className="w-full bg-white/5 border border-white/10 p-3 rounded-lg mb-4"
                                            value={newWhiteboard.grade} onChange={e => setNewWhiteboard({...newWhiteboard, grade: e.target.value})}>
                                            <option value="1sec">Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„</option>
                                            <option value="2sec">Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù†ÙŠ</option>
                                            <option value="3sec">Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù„Ø«</option>
                                        </select>
                                        <button onClick={() => { if (newWhiteboard.title && newWhiteboard.link) { uploadItem('whiteboards', newWhiteboard); setNewWhiteboard({ title: '', link: '', grade: '1sec' }); } }}
                                            className="btn-primary px-6 py-3 rounded-lg font-bold">Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø³Ø¨ÙˆØ±Ø©</button>
                                    </div>
                                    <div className="grid md:grid-cols-3 gap-6">
                                        {dataState.whiteboards.map(wb => (
                                            <div key={wb.id} className="glass-panel p-4">
                                                <h3 className="font-bold mb-2">{wb.title}</h3>
                                                <a href={wb.link} target="_blank" className="text-[#d4af37] hover:underline">Ø¹Ø±Ø¶</a>
                                                <span className={`block mt-2 px-2 py-1 rounded text-xs grade-badge-${wb.grade}`}>
                                                    {wb.grade === '1sec' ? 'Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„' : wb.grade === '2sec' ? 'Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù†ÙŠ' : 'Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù„Ø«'}
                                                </span>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            )}

                            {/* Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†Ø§Øª */}
                            {adminTab === 'exams' && (
                                <div>
                                    <div className="flex justify-between items-center mb-6">
                                        <h2 className="text-2xl font-bold">Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†Ø§Øª</h2>
                                        <button onClick={() => setShowExamBuilder(true)} className="btn-primary px-6 py-3 rounded-lg font-bold flex items-center gap-2">
                                            <Icon name="plus" /> Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù…ØªØ­Ø§Ù†
                                        </button>
                                    </div>
                                    <div className="grid md:grid-cols-2 gap-6">
                                        {dataState.exams.map(exam => (
                                            <div key={exam.id} className="glass-panel p-6">
                                                <h3 className="font-bold text-lg mb-2">{exam.title}</h3>
                                                <p className="text-slate-400 text-sm mb-4 line-clamp-2">{exam.question}</p>
                                                <div className="flex justify-between items-center">
                                                    <span className={`px-2 py-1 rounded text-xs grade-badge-${exam.grade}`}>
                                                        {exam.grade === '1sec' ? 'Ø£ÙˆÙ„Ù‰' : exam.grade === '2sec' ? 'ØªØ§Ù†ÙŠØ©' : 'ØªØ§Ù„ØªØ©'}
                                                    </span>
                                                    <span className="text-xs text-slate-400">{exam.type === 'mcq' ? 'Ø§Ø®ØªÙŠØ§Ø±ÙŠ' : 'Ù…Ù‚Ø§Ù„ÙŠ'}</span>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            )}

                            {/* Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø·Ù„Ø§Ø¨ */}
                            {adminTab === 'results' && (
                                <ResultsPage results={dataState.examResults} students={dataState.students} />
                            )}
                        </main>

                        {showExamBuilder && (
                            <ExamBuilder onClose={() => setShowExamBuilder(false)} onSave={addExam} isDarkMode={isDarkMode} />
                        )}
                    </div>
                );
            }

            // ================ Ø´Ø§Ø´Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ ================
            if (view === 'loading') return (
                <div className="h-screen bg-[#1a1a1a] flex items-center justify-center">
                    <div className="text-center">
                        <div className="w-16 h-16 border-4 border-[#d4af37] border-t-transparent rounded-full animate-spin mx-auto mb-4"></div>
                        <p className="text-[#d4af37]">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</p>
                    </div>
                </div>
            );

            // ================ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª ================
            return (
                <>
                    {notification && (
                        <div className={`fixed top-5 left-1/2 -translate-x-1/2 px-6 py-3 rounded-xl shadow-2xl font-bold z-[100] text-white flex items-center gap-4 ${notification.type === 'error' ? 'bg-[#8b0000]' : 'bg-[#2e7d32]'}`}>
                            <Icon name={notification.type === 'error' ? 'alert-circle' : 'check-circle'} />
                            {notification.message}
                        </div>
                    )}
                </>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>