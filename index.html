<!DOCTYPE html>
<html dir="rtl" lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ù†ØµØ© Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠ Ù„Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª | Ø£/ Ø£Ø­Ù…Ø¯ Ø³Ø¹Ø¯ ÙŠÙˆÙ†Ø³</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getDatabase, ref, set, get, child, push, update, onValue, remove } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";
        import { getAuth, signInWithPopup, GoogleAuthProvider, FacebookAuthProvider, signOut, onAuthStateChanged, signInAnonymously } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAWvMBrjkjU02jfOe8HKNnDHNx1ZshlDdo",
            authDomain: "el-alamy-platform.firebaseapp.com",
            projectId: "el-alamy-platform",
            storageBucket: "el-alamy-platform.firebasestorage.app",
            messagingSenderId: "790950981758",
            appId: "1:790950981758:web:21cf7c65e9d2cce210a82f",
            measurementId: "G-970BP0VKQQ",
            databaseURL: "https://el-alamy-platform-default-rtdb.firebaseio.com"
        };

        const app = initializeApp(firebaseConfig);
        window.db = getDatabase(app);
        window.auth = getAuth(app);
        window.googleProvider = new GoogleAuthProvider();
        window.facebookProvider = new FacebookAuthProvider();
        window.rtdb = { ref, set, get, child, push, update, onValue, remove };
        window.authMethods = { signInWithPopup, signOut, onAuthStateChanged, signInAnonymously };
    </script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;900&display=swap');
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Cairo', sans-serif; background: #0f172a; color: white; overflow-x: hidden; }
        .glass { background: rgba(30, 41, 59, 0.85); backdrop-filter: blur(16px); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 16px; box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4); }
        .btn-gold { background: linear-gradient(135deg, #fbbf24, #d97706); color: #0f172a; font-weight: 800; transition: all 0.3s; }
        .btn-gold:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(251, 191, 36, 0.5); }
        .embed { position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden; border-radius: 12px; background: #000; }
        .embed iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: 0; }
        .grid-bg { background-image: linear-gradient(rgba(255, 255, 255, 0.03) 1px, transparent 1px), linear-gradient(90deg, rgba(255, 255, 255, 0.03) 1px, transparent 1px); background-size: 30px 30px; }
        .glow { background: radial-gradient(circle at 50% 50%, rgba(59, 130, 246, 0.15) 0%, transparent 50%); }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #0f172a; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 4px; }
        .loader { border: 4px solid rgba(255, 255, 255, 0.1); border-radius: 50%; border-top: 4px solid #fbbf24; width: 50px; height: 50px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        @keyframes slideUp { 0% { transform: translateY(30px); opacity: 0; } 100% { transform: translateY(0); opacity: 1; } }
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-20px); } }
        .slide-up { animation: slideUp 0.8s ease-out; }
        .float { animation: float 6s ease-in-out infinite; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;
        
        const ADMIN_CODES = {
            'BOSS-2025': 'boss',
            'ADMIN-001': 'admin', 'ADMIN-002': 'admin', 'ADMIN-003': 'admin', 'ADMIN-004': 'admin',
            'ADMIN-005': 'admin', 'ADMIN-006': 'admin', 'ADMIN-007': 'admin', 'ADMIN-008': 'admin',
            'ADMIN-009': 'admin', 'ADMIN-010': 'admin'
        };

        const CONTACT = {
            whatsapp: 'https://wa.me/201000000000',
            facebook: 'https://facebook.com/yourpage',
            youtube: 'https://youtube.com/yourchannel',
            telegram: 'https://t.me/yourchannel',
            vodafone: '010xxxxxxxx',
            fawry: '12345',
            support: 'https://wa.me/201000000000'
        };

        const Icon = ({ name, size = 20, className = '' }) => {
            useEffect(() => { if (window.lucide) window.lucide.createIcons(); });
            return <i data-lucide={name} style={{ width: size, height: size }} className={className}></i>;
        };

        const App = () => {
            const [user, setUser] = useState(null);
            const [view, setView] = useState('loading');
            const [data, setData] = useState({
                students: [], requests: [], lectures: [], whiteboards: [], qa: [],
                exams: [], announcements: [], payments: [], packages: [], subscriptions: {}
            });
            const [form, setForm] = useState({
                firstName: '', secondName: '', thirdName: '', phone: '', parentPhone: '',
                school: '', governorate: '', city: '', grade: '1sec', address: ''
            });
            const [tab, setTab] = useState('home');
            const [selected, setSelected] = useState({ lecture: null, student: null, package: null });
            const [modal, setModal] = useState({ student: false, payment: false });
            const [search, setSearch] = useState('');
            const [codes, setCodes] = useState({ student: '', phone: '', admin: '' });
            const [step, setStep] = useState('video');
            const [answers, setAnswers] = useState({});
            const [payment, setPayment] = useState('vodafone');
            const [notify, setNotify] = useState(null);
            const [examModel, setExamModel] = useState('A');

            const show = (msg, type = 'success') => {
                setNotify({ msg, type });
                setTimeout(() => setNotify(null), 4000);
            };

            const code = (p = 'STU') => `${p}-${Math.random().toString(36).substr(2, 6).toUpperCase()}`;

            useEffect(() => {
                window.authMethods.onAuthStateChanged(window.auth, async (u) => {
                    if (u) {
                        if (u.isAnonymous) {
                            setUser({ uid: u.uid, isGuest: true, name: 'Ø²Ø§Ø¦Ø±' });
                            setView('guest');
                            return;
                        }
                        const s = await window.rtdb.get(window.rtdb.child(window.rtdb.ref(window.db), `users/${u.uid}`));
                        if (s.exists()) {
                            const userData = s.val();
                            setUser({ ...userData, uid: u.uid, photo: u.photoURL });
                            setView(['admin', 'boss'].includes(userData.role) ? 'admin' : userData.status === 'pending' ? 'pending' : 'student');
                        } else {
                            setUser({ uid: u.uid, name: u.displayName, email: u.email, photo: u.photoURL, isNew: true });
                            setView('register');
                        }
                    } else {
                        setUser(null);
                        setView('landing');
                    }
                });
            }, []);

            useEffect(() => {
                if (user && !user.isGuest) {
                    ['lectures', 'whiteboards', 'qa', 'announcements', 'exams', 'packages'].forEach(t =>
                        window.rtdb.onValue(window.rtdb.ref(window.db, t), s =>
                            setData(p => ({ ...p, [t]: s.val() ? Object.entries(s.val()).map(([k, v]) => ({ id: k, ...v })).sort((a, b) => (b.ts || 0) - (a.ts || 0)) : [] }))
                        )
                    );
                    if (['admin', 'boss'].includes(user.role)) {
                        window.rtdb.onValue(window.rtdb.ref(window.db, 'requests'), s =>
                            setData(p => ({ ...p, requests: s.val() ? Object.entries(s.val()).map(([k, v]) => ({ id: k, ...v })) : [] }))
                        );
                        window.rtdb.onValue(window.rtdb.ref(window.db, 'users'), s =>
                            setData(p => ({ ...p, students: s.val() ? Object.entries(s.val()).map(([k, v]) => ({ id: k, ...v })).filter(u => u.role === 'student') : [] }))
                        );
                        window.rtdb.onValue(window.rtdb.ref(window.db, 'payments'), s =>
                            setData(p => ({ ...p, payments: s.val() ? Object.entries(s.val()).map(([k, v]) => ({ id: k, ...v })) : [] }))
                        );
                    }
                }
            }, [user]);

            const render = (link) => {
                if (!link) return null;
                if (link.startsWith('<iframe')) return <div className="embed" dangerouslySetInnerHTML={{ __html: link }} />;
                if (link.includes('youtu')) {
                    const id = link.match(/(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/\s]{11})/)?.[1];
                    return id ? <div className="embed"><iframe src={`https://www.youtube.com/embed/${id}`} allowFullScreen></iframe></div> : null;
                }
                if (link.match(/\.(jpeg|jpg|gif|png)$/) || link.includes('ibb.co'))
                    return <img src={link} className="w-full rounded-xl shadow-lg" onError={(e) => { e.target.src = 'https://placehold.co/600x400?text=Ø®Ø·Ø£'; }} />;
                if (link.includes('drive.google.com'))
                    return <div className="embed"><iframe src={link.replace('/view', '/preview')} allowFullScreen></iframe></div>;
                return <a href={link} target="_blank" className="block w-full bg-white/10 text-white text-center py-3 rounded-xl font-bold">ğŸ”— ÙØªØ­</a>;
            };

            const login = async () => {
                const st = data.students.find(s => s.code === codes.student || s.phone === codes.phone);
                if (st) {
                    setUser(st);
                    setView(st.status === 'pending' ? 'pending' : 'student');
                    show(`Ù…Ø±Ø­Ø¨Ø§Ù‹ ${st.firstName}!`);
                } else show('Ø§Ù„ÙƒÙˆØ¯ Ø£Ùˆ Ø§Ù„Ø±Ù‚Ù… ØºÙŠØ± ØµØ­ÙŠØ­', 'error');
            };

            const upload = async (col, d) => {
                await window.rtdb.push(window.rtdb.ref(window.db, col), { ...d, date: new Date().toLocaleDateString('ar-EG'), ts: Date.now() });
                show('ØªÙ… Ø§Ù„Ù†Ø´Ø± âœ…');
            };

            const update = async (id, d) => {
                await window.rtdb.update(window.rtdb.ref(window.db, `users/${id}`), d);
                show('ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ« ğŸ‘Œ');
            };

            const activate = async (sid, pid) => {
                const pkg = data.packages.find(p => p.id === pid);
                if (!pkg) return;
                const now = new Date();
                const end = new Date(now.setMonth(now.getMonth() + parseInt(pkg.months)));
                await window.rtdb.update(window.rtdb.ref(window.db, `users/${sid}`), {
                    isPaid: true,
                    currentPackage: pkg.name,
                    subscriptionEnd: end.toISOString()
                });
                await window.rtdb.push(window.rtdb.ref(window.db, `subscriptions/${sid}`), {
                    packageId: pid,
                    packageName: pkg.name,
                    months: pkg.months,
                    price: pkg.price,
                    startDate: new Date().toISOString(),
                    endDate: end.toISOString(),
                    ts: Date.now()
                });
                show(`ØªÙ… ØªÙØ¹ÙŠÙ„ ${pkg.name}`);
            };

            const adminLogin = async () => {
                if (!user) return show('Ø³Ø¬Ù„ Ø£ÙˆÙ„Ø§Ù‹', 'error');
                if (ADMIN_CODES[codes.admin]) {
                    await window.rtdb.set(window.rtdb.ref(window.db, 'users/' + user.uid), {
                        ...user,
                        role: ADMIN_CODES[codes.admin],
                        isNew: false
                    });
                    window.location.reload();
                } else show('ÙƒÙˆØ¯ Ø®Ø§Ø·Ø¦', 'error');
            };

            // LANDING
            if (view === 'landing') return (
                <div className="min-h-screen bg-gradient-to-b from-slate-900 to-slate-950 text-white relative overflow-hidden grid-bg">
                    <div className="absolute inset-0 glow"></div>
                    <header className="relative z-50 p-6 flex justify-between items-center container mx-auto">
                        <div className="flex items-center gap-3">
                            <div className="w-10 h-10 bg-amber-400 rounded-lg flex items-center justify-center text-slate-900 font-black text-xl">âˆ‘</div>
                            <h1 className="text-2xl font-black">Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠ</h1>
                        </div>
                        <div className="flex gap-3 flex-wrap">
                            <button onClick={() => setView('login')} className="bg-blue-600/20 border border-blue-500/30 px-6 py-2 rounded-full font-bold hover:bg-blue-600/40 transition">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø·Ø§Ù„Ø¨</button>
                            <button onClick={() => window.authMethods.signInAnonymously(window.auth)} className="bg-white/10 border border-white/20 px-6 py-2 rounded-full font-bold hover:bg-white/20 transition">ØªØµÙØ­ ÙƒØ²Ø§Ø¦Ø±</button>
                            <button onClick={() => window.authMethods.signInWithPopup(window.auth, window.googleProvider)} className="bg-white/10 border border-white/20 px-6 py-2 rounded-full font-bold hover:bg-white/20 transition">ØªØ³Ø¬ÙŠÙ„ Ø¬Ø¯ÙŠØ¯</button>
                        </div>
                    </header>

                    <div className="flex-1 container mx-auto px-4 flex flex-col-reverse md:flex-row items-center justify-center gap-10 relative z-20 py-10">
                        <div className="text-center md:text-right space-y-6 md:w-1/2 slide-up">
                            <div className="inline-block bg-blue-500/20 text-blue-300 px-4 py-1 rounded-full text-sm font-bold border border-blue-500/30">
                                ğŸš€ Ø£Ù‚ÙˆÙ‰ Ù…Ù†ØµØ© Ø±ÙŠØ§Ø¶ÙŠØ§Øª ÙÙŠ Ù…ØµØ±
                            </div>
                            <h1 className="text-5xl md:text-7xl font-black leading-tight">
                                Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª<br /><span className="text-amber-400">Ù„Ø¹Ø¨ØªÙƒ Ù…Ø¹Ø§Ù†Ø§!</span>
                            </h1>
                            <p className="text-slate-300 text-lg md:text-xl font-medium max-w-lg mx-auto md:mx-0">
                                Ù…Ø¹ Ø£/ Ø£Ø­Ù…Ø¯ Ø³Ø¹Ø¯ ÙŠÙˆÙ†Ø³.. Ø§Ù„ØªÙØ§Ø¶Ù„ ÙˆØ§Ù„ØªÙƒØ§Ù…Ù„ ÙˆØ§Ù„Ø¬Ø¨Ø± Ø¨Ù‚ÙˆØ§ Ø£Ø³Ù‡Ù„ Ù…Ù…Ø§ ØªØªØ®ÙŠÙ„.
                            </p>
                            <div className="flex flex-col sm:flex-row gap-4 justify-center md:justify-start pt-4">
                                <button onClick={() => window.authMethods.signInWithPopup(window.auth, window.googleProvider)}
                                    className="btn-gold px-8 py-4 rounded-xl text-xl flex items-center justify-center gap-2">
                                    Ø§Ø´ØªØ±Ùƒ Ø§Ù„Ø¢Ù† <Icon name="calculator" />
                                </button>
                                <div className="relative">
                                    <input placeholder="ÙƒÙˆØ¯ Ø§Ù„Ø£Ø¯Ù…Ù†" className="bg-white/5 border border-white/10 rounded-xl px-4 py-4 text-center w-full outline-none"
                                        onChange={e => setCodes({ ...codes, admin: e.target.value })} />
                                    <button onClick={adminLogin} className="absolute left-3 top-1/2 -translate-y-1/2 text-xs text-gray-500 hover:text-amber-400">Ø¯Ø®ÙˆÙ„</button>
                                </div>
                            </div>
                        </div>
                        <div className="md:w-1/2 relative flex justify-center">
                            <div className="absolute inset-0 bg-blue-600/30 blur-[100px] rounded-full"></div>
                            <img src="./alalamy.png" className="relative z-10 w-full max-w-md object-contain drop-shadow-2xl float" alt="Ø§Ù„Ù…Ø¯Ø±Ø³" onError={(e) => { e.target.style.display = 'none' }} />
                        </div>
                    </div>

                    <section className="py-20 relative z-20 bg-black/20">
                        <div className="container mx-auto px-4">
                            <h2 className="text-4xl font-black text-center mb-16">Ù„ÙŠÙ‡ <span className="text-amber-400">Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠ</span>ØŸ</h2>
                            <div className="grid md:grid-cols-3 gap-8">
                                {[
                                    { icon: 'brain', title: 'Ø´Ø±Ø­ Ù…Ø¨Ø³Ø·', desc: 'Ø¨Ù†Ø¨Ø³Ø·Ù„Ùƒ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø© ÙˆÙ†Ø®Ù„ÙŠÙ‡Ø§ Ø³Ù‡Ù„Ø©' },
                                    { icon: 'target', title: 'Ø­Ù„ Ø´Ø§Ù…Ù„', desc: 'Ø­Ù„ Ù…Ù† ÙƒÙ„ Ø§Ù„Ù…ØµØ§Ø¯Ø± ÙˆØ§Ù„Ø§Ù…ØªØ­Ø§Ù†Ø§Øª' },
                                    { icon: 'message-circle', title: 'Ù…ØªØ§Ø¨Ø¹Ø© 24/7', desc: 'Ø§Ù„Ø¯Ø¹Ù… Ù…Ø¹Ø§Ùƒ ÙÙŠ Ø£ÙŠ ÙˆÙ‚Øª' }
                                ].map((f, i) => (
                                    <div key={i} className="glass p-8 text-center hover:-translate-y-2 transition">
                                        <div className="w-16 h-16 bg-amber-400/20 rounded-full flex items-center justify-center mx-auto mb-4 text-amber-400">
                                            <Icon name={f.icon} size={32} />
                                        </div>
                                        <h3 className="text-xl font-bold mb-2">{f.title}</h3>
                                        <p className="text-slate-400">{f.desc}</p>
                                    </div>
                                ))}
                            </div>
                        </div>
                    </section>

                    <section className="py-10 bg-slate-800/50">
                        <div className="container mx-auto px-4">
                            <h3 className="text-center text-lg font-bold mb-6">ØªØ§Ø¨Ø¹Ù†Ø§:</h3>
                            <div className="flex justify-center gap-6 flex-wrap">
                                <a href={CONTACT.facebook} target="_blank" className="flex items-center gap-2 bg-blue-600/20 border border-blue-500/30 px-6 py-3 rounded-xl hover:bg-blue-600/40 transition">
                                    <Icon name="facebook" /> Facebook
                                </a>
                                <a href={CONTACT.youtube} target="_blank" className="flex items-center gap-2 bg-red-600/20 border border-red-500/30 px-6 py-3 rounded-xl hover:bg-red-600/40 transition">
                                    <Icon name="youtube" /> YouTube
                                </a>
                                <a href={CONTACT.whatsapp} target="_blank" className="flex items-center gap-2 bg-green-600/20 border border-green-500/30 px-6 py-3 rounded-xl hover:bg-green-600/40 transition">
                                    <Icon name="message-circle" /> WhatsApp
                                </a>
                            </div>
                        </div>
                    </section>

                    <div className="py-6 text-center text-slate-500 text-sm">Developed with â¤ï¸ by Marwan</div>
                </div>
            );

            // LOGIN
            if (view === 'login') return (
                <div className="min-h-screen bg-slate-900 flex items-center justify-center p-4">
                    <div className="glass p-8 w-full max-w-md slide-up">
                        <div className="text-center mb-8">
                            <div className="w-20 h-20 bg-amber-400/20 rounded-full flex items-center justify-center mx-auto mb-4">
                                <Icon name="key" size={40} className="text-amber-400" />
                            </div>
                            <h2 className="text-3xl font-bold mb-2">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø·Ø§Ù„Ø¨</h2>
                            <p className="text-slate-400">Ø£Ø¯Ø®Ù„ Ø§Ù„ÙƒÙˆØ¯ Ø£Ùˆ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</p>
                        </div>

                        <div className="space-y-6">
                            <div>
                                <label className="text-sm text-slate-400 mb-2 block">Ø§Ù„ÙƒÙˆØ¯:</label>
                                <input className="w-full p-4 bg-white/5 border border-white/10 rounded-xl outline-none text-white text-center text-2xl tracking-widest font-mono"
                                    placeholder="STU-XXXXXX"
                                    value={codes.student}
                                    onChange={e => setCodes({ ...codes, student: e.target.value.toUpperCase() })} />
                            </div>

                            <div className="text-center text-slate-500 text-sm">Ø£Ùˆ</div>

                            <div>
                                <label className="text-sm text-slate-400 mb-2 block">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ:</label>
                                <input className="w-full p-4 bg-white/5 border border-white/10 rounded-xl outline-none text-white text-center"
                                    placeholder="01xxxxxxxxx"
                                    value={codes.phone}
                                    onChange={e => setCodes({ ...codes, phone: e.target.value })} />
                            </div>

                            <button onClick={login} className="btn-gold w-full py-4 rounded-xl text-lg font-bold flex items-center justify-center gap-2">
                                <Icon name="log-in" /> Ø¯Ø®ÙˆÙ„
                            </button>

                            <div className="text-center space-y-2">
                                <p className="text-slate-500 text-sm">Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ØŸ</p>
                                <div className="grid grid-cols-2 gap-2">
                                    <button onClick={() => window.authMethods.signInWithPopup(window.auth, window.googleProvider)}
                                        className="bg-red-600/20 border border-red-500/30 py-2 rounded-lg text-sm hover:bg-red-600/40 transition">
                                        <Icon name="mail" size={16} className="inline" /> Google
                                    </button>
                                    <button onClick={() => window.authMethods.signInWithPopup(window.auth, window.facebookProvider)}
                                        className="bg-blue-600/20 border border-blue-500/30 py-2 rounded-lg text-sm hover:bg-blue-600/40 transition">
                                        <Icon name="facebook" size={16} className="inline" /> Facebook
                                    </button>
                                </div>
                            </div>

                            <button onClick={() => setView('landing')} className="w-full text-slate-400 hover:text-white text-sm">â† Ø±Ø¬ÙˆØ¹</button>
                        </div>
                    </div>
                </div>
            );

            // GUEST
            if (view === 'guest') return (
                <div className="min-h-screen bg-slate-900 p-4">
                    <div className="max-w-4xl mx-auto">
                        <div className="glass p-8 text-center mb-6">
                            <Icon name="eye" size={48} className="mx-auto text-amber-400 mb-4" />
                            <h2 className="text-2xl font-bold mb-2">ÙˆØ¶Ø¹ Ø§Ù„Ø²Ø§Ø¦Ø±</h2>
                            <p className="text-slate-400 mb-6">ÙŠÙ…ÙƒÙ†Ùƒ Ù…Ø´Ø§Ù‡Ø¯Ø© Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…Ø¬Ø§Ù†ÙŠ. Ù„Ù„ÙˆØµÙˆÙ„ Ø§Ù„ÙƒØ§Ù…Ù„ Ø³Ø¬Ù„ Ø­Ø³Ø§Ø¨.</p>
                            <div className="flex gap-4 justify-center">
                                <button onClick={() => window.authMethods.signInWithPopup(window.auth, window.googleProvider)} className="btn-gold px-6 py-3 rounded-xl">ØªØ³Ø¬ÙŠÙ„</button>
                                <button onClick={() => window.authMethods.signOut(window.auth)} className="px-6 py-3 bg-white/10 rounded-xl hover:bg-white/20">Ø®Ø±ÙˆØ¬</button>
                            </div>
                        </div>

                        <div className="grid md:grid-cols-2 gap-6">
                            {data.lectures.filter(l => l.isFree).map(lec => (
                                <div key={lec.id} className="glass p-6">
                                    <h3 className="font-bold text-lg mb-2">{lec.title}</h3>
                                    <p className="text-sm text-slate-400 mb-4">{lec.description}</p>
                                    <button onClick={() => { setSelected({ ...selected, lecture: lec }); setStep('video'); }} className="btn-gold w-full py-2 rounded-lg">Ù…Ø´Ø§Ù‡Ø¯Ø©</button>
                                </div>
                            ))}
                        </div>
                    </div>
                </div>
            );

            // PENDING
            if (view === 'pending') return (
                <div className="min-h-screen bg-slate-900 flex items-center justify-center p-4">
                    <div className="glass p-8 w-full max-w-lg text-center slide-up">
                        <div className="w-24 h-24 bg-orange-500/20 rounded-full flex items-center justify-center mx-auto mb-4">
                            <Icon name="clock" size={48} className="text-orange-400" />
                        </div>
                        <h2 className="text-3xl font-bold mb-4">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©!</h2>
                        <p className="text-slate-300 mb-6">ØªÙ… Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø·Ù„Ø¨Ùƒ. Ø³ÙŠØªÙ… Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹Ùƒ Ù‚Ø±ÙŠØ¨Ø§Ù‹.</p>
                        <button onClick={() => window.authMethods.signOut(window.auth)} className="px-6 py-2 bg-white/10 rounded-lg hover:bg-white/20">Ø±Ø¬ÙˆØ¹</button>
                    </div>
                </div>
            );

            // REGISTER
            if (view === 'register') return (
                <div className="min-h-screen bg-slate-900 flex items-center justify-center p-4">
                    <div className="glass p-8 w-full max-w-2xl slide-up">
                        <div className="text-center mb-8">
                            <img src={user.photo} className="w-20 h-20 rounded-full mx-auto mb-4 border-4 border-amber-400" />
                            <h2 className="text-3xl font-bold mb-2">Ø£Ù‡Ù„Ø§Ù‹!</h2>
                            <p className="text-slate-400">ÙƒÙ…Ù„ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ</p>
                        </div>

                        <div className="space-y-4">
                            <div className="grid md:grid-cols-3 gap-4">
                                <input className="w-full p-4 bg-white/5 border border-white/10 rounded-xl outline-none text-white" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø£ÙˆÙ„ *" onChange={e => setForm({ ...form, firstName: e.target.value })} />
                                <input className="w-full p-4 bg-white/5 border border-white/10 rounded-xl outline-none text-white" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø«Ø§Ù†ÙŠ *" onChange={e => setForm({ ...form, secondName: e.target.value })} />
                                <input className="w-full p-4 bg-white/5 border border-white/10 rounded-xl outline-none text-white" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø«Ø§Ù„Ø«" onChange={e => setForm({ ...form, thirdName: e.target.value })} />
                            </div>

                            <div className="grid md:grid-cols-2 gap-4">
                                <input className="w-full p-4 bg-white/5 border border-white/10 rounded-xl outline-none text-white" placeholder="Ø±Ù‚Ù… ØªÙ„ÙŠÙÙˆÙ†Ùƒ *" onChange={e => setForm({ ...form, phone: e.target.value })} />
                                <input className="w-full p-4 bg-white/5 border border-white/10 rounded-xl outline-none text-white" placeholder="Ø±Ù‚Ù… ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø± *" onChange={e => setForm({ ...form, parentPhone: e.target.value })} />
                            </div>

                            <input className="w-full p-4 bg-white/5 border border-white/10 rounded-xl outline-none text-white" placeholder="Ø§Ù„Ù…Ø¯Ø±Ø³Ø© *" onChange={e => setForm({ ...form, school: e.target.value })} />

                            <div className="grid md:grid-cols-2 gap-4">
                                <input className="w-full p-4 bg-white/5 border border-white/10 rounded-xl outline-none text-white" placeholder="Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø© *" onChange={e => setForm({ ...form, governorate: e.target.value })} />
                                <input className="w-full p-4 bg-white/5 border border-white/10 rounded-xl outline-none text-white" placeholder="Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© *" onChange={e => setForm({ ...form, city: e.target.value })} />
                            </div>

                            <select className="w-full p-4 bg-white/5 border border-white/10 rounded-xl outline-none text-white" onChange={e => setForm({ ...form, grade: e.target.value })}>
                                <option value="">Ø§Ø®ØªØ± Ø§Ù„ØµÙ *</option>
                                <option value="1sec">Ø£ÙˆÙ„ Ø«Ø§Ù†ÙˆÙŠ</option>
                                <option value="2sec">Ø«Ø§Ù†ÙŠ Ø«Ø§Ù†ÙˆÙŠ</option>
                                <option value="3sec">Ø«Ø§Ù„Ø« Ø«Ø§Ù†ÙˆÙŠ</option>
                            </select>

                            <button onClick={async () => {
                                const req = ['firstName', 'secondName', 'phone', 'parentPhone', 'school', 'governorate', 'city', 'grade'];
                                if (req.some(f => !form[f])) return show('Ø§ÙƒØªØ¨ ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'error');
                                const c = code();
                                await window.rtdb.push(window.rtdb.ref(window.db, 'requests'), {
                                    ...form,
                                    name: `${form.firstName} ${form.secondName} ${form.thirdName}`.trim(),
                                    uid: user.uid,
                                    email: user.email,
                                    photo: user.photo,
                                    code: c,
                                    status: 'pending',
                                    date: new Date().toLocaleDateString(),
                                    ts: Date.now()
                                });
                                show('ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨Ùƒ!');
                                setTimeout(() => setView('pending'), 2000);
                            }} className="btn-gold w-full py-4 rounded-xl text-lg font-bold">
                                <Icon name="send" /> Ø¥Ø±Ø³Ø§Ù„
                            </button>
                        </div>
                    </div>
                </div>
            );

            // STUDENT
            if (view === 'student') {
                const pkgs = Object.values(data.subscriptions[user.uid] || {});
                return (
                    <div className="min-h-screen bg-slate-900 p-4">
                        <div className="max-w-6xl mx-auto">
                            <div className="glass p-6 mb-6">
                                <div className="flex justify-between items-center">
                                    <div>
                                        <h2 className="text-2xl font-bold">Ø£Ù‡Ù„Ø§Ù‹ {user.firstName}</h2>
                                        <p className="text-sm text-slate-400">ÙƒÙˆØ¯: {user.code}</p>
                                    </div>
                                    <button onClick={() => window.authMethods.signOut(window.auth)} className="px-4 py-2 bg-red-600/20 rounded-lg hover:bg-red-600/40">Ø®Ø±ÙˆØ¬</button>
                                </div>
                            </div>

                            <div className="flex gap-2 mb-6 overflow-x-auto pb-2">
                                {['home', 'lectures', 'packages', 'qa'].map(t => (
                                    <button key={t} onClick={() => setTab(t)} className={`px-6 py-2 rounded-lg font-bold whitespace-nowrap ${tab === t ? 'bg-amber-400 text-slate-900' : 'bg-white/5 hover:bg-white/10'}`}>
                                        {t === 'home' ? 'Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©' : t === 'lectures' ? 'Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª' : t === 'packages' ? 'Ø§Ù„Ø¨Ø§Ù‚Ø§Øª' : 'Ø§Ù„Ø£Ø³Ø¦Ù„Ø©'}
                                    </button>
                                ))}
                            </div>

                            {tab === 'home' && (
                                <div className="space-y-6">
                                    <div className="glass p-6">
                                        <h3 className="font-bold mb-4">Ø§Ø´ØªØ±Ø§ÙƒØ§ØªÙŠ:</h3>
                                        {pkgs.length === 0 ? <p className="text-slate-500">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø§Ø´ØªØ±Ø§ÙƒØ§Øª</p> :
                                            pkgs.map((s, i) => (
                                                <div key={i} className="bg-white/5 p-4 rounded-lg mb-3">
                                                    <h4 className="font-bold">{s.packageName}</h4>
                                                    <p className="text-sm text-slate-400">ÙŠÙ†ØªÙ‡ÙŠ: {new Date(s.endDate).toLocaleDateString('ar-EG')}</p>
                                                </div>
                                            ))
                                        }
                                    </div>

                                    <div className="glass p-6">
                                        <h3 className="font-bold mb-4">Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª:</h3>
                                        {data.announcements.slice(0, 3).map(a => (
                                            <div key={a.id} className="bg-white/5 p-4 rounded-lg mb-3">
                                                <h4 className="font-bold">{a.title}</h4>
                                                <p className="text-sm text-slate-400">{a.content}</p>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            )}

                            {tab === 'lectures' && !user.isPaid && (
                                <div className="glass p-10 text-center">
                                    <Icon name="lock" size={48} className="text-amber-400 mx-auto mb-4" />
                                    <h3 className="text-2xl font-bold mb-3">Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ù…ØºÙ„Ù‚</h3>
                                    <p className="text-slate-400 mb-6">Ø§Ø´ØªØ±Ùƒ ÙÙŠ Ø¥Ø­Ø¯Ù‰ Ø§Ù„Ø¨Ø§Ù‚Ø§Øª</p>
                                    <button onClick={() => setTab('packages')} className="btn-gold px-8 py-3 rounded-xl">Ø¹Ø±Ø¶ Ø§Ù„Ø¨Ø§Ù‚Ø§Øª</button>
                                </div>
                            )}

                            {tab === 'lectures' && user.isPaid && (
                                <div className="grid md:grid-cols-3 gap-6">
                                    {data.lectures.filter(l => !l.grade || l.grade === user.grade || l.grade === 'all').map(lec => (
                                        <div key={lec.id} onClick={() => { setSelected({ ...selected, lecture: lec }); setStep('video'); }} className="glass overflow-hidden cursor-pointer hover:border-amber-400/50 transition">
                                            <div className="h-40 bg-slate-800 flex items-center justify-center">
                                                <Icon name="play-circle" size={56} className="text-white/80" />
                                            </div>
                                            <div className="p-5">
                                                <h3 className="font-bold mb-2">{lec.title}</h3>
                                                <p className="text-xs text-slate-400 line-clamp-2">{lec.description}</p>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            )}

                            {tab === 'packages' && (
                                <div className="grid md:grid-cols-3 gap-6">
                                    {data.packages.map(pkg => (
                                        <div key={pkg.id} className="glass p-6 hover:border-amber-400/50 transition">
                                            <div className="text-center mb-4">
                                                <h3 className="text-2xl font-bold mb-2">{pkg.name}</h3>
                                                <p className="text-3xl font-black text-amber-400">{pkg.price} Ø¬</p>
                                                <p className="text-sm text-slate-400">{pkg.months} Ø´Ù‡Ø±</p>
                                            </div>
                                            <ul className="space-y-2 mb-6 text-sm">
                                                {pkg.features?.split('\n').map((f, i) => (
                                                    <li key={i} className="flex items-center gap-2">
                                                        <Icon name="check" size={16} className="text-green-400" />
                                                        {f}
                                                    </li>
                                                ))}
                                            </ul>
                                            <button onClick={() => { setSelected({ ...selected, package: pkg }); setModal({ ...modal, payment: true }); }} className="btn-gold w-full py-3 rounded-xl">Ø§Ø´ØªØ±Ùƒ</button>
                                        </div>
                                    ))}
                                </div>
                            )}

                            {tab === 'qa' && (
                                <div className="glass p-6">
                                    <div className="flex gap-2 mb-6">
                                        <input id="qIn" className="flex-1 bg-white/5 border border-white/10 p-3 rounded-xl outline-none" placeholder="Ø³Ø¤Ø§Ù„Ùƒ..." />
                                        <button onClick={async () => {
                                            const q = document.getElementById('qIn').value;
                                            if (q) {
                                                await window.rtdb.push(window.rtdb.ref(window.db, 'qa'), {
                                                    studentName: `${user.firstName} ${user.secondName}`,
                                                    studentId: user.uid,
                                                    question: q,
                                                    studentCode: user.code,
                                                    category: 'Ù…Ù†Ù‡Ø¬',
                                                    date: new Date().toLocaleDateString('ar-EG'),
                                                    ts: Date.now()
                                                });
                                                document.getElementById('qIn').value = '';
                                                show('ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„');
                                            }
                                        }} className="btn-gold px-6 rounded-xl">Ø¥Ø±Ø³Ø§Ù„</button>
                                    </div>

                                    <div className="space-y-3">
                                        {data.qa.filter(q => q.studentId === user.uid).map(q => (
                                            <div key={q.id} className="bg-white/5 p-4 rounded-lg">
                                                <p className="font-bold mb-2">{q.question}</p>
                                                {q.reply && (
                                                    <div className="bg-green-500/10 p-3 rounded-lg mt-2">
                                                        <p className="text-sm text-green-300">{q.reply}</p>
                                                    </div>
                                                )}
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            )}

                            {/* Payment Modal */}
                            {modal.payment && selected.package && (
                                <div className="fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4" onClick={() => setModal({ ...modal, payment: false })}>
                                    <div className="glass p-6 w-full max-w-md" onClick={e => e.stopPropagation()}>
                                        <h3 className="text-xl font-bold mb-4">Ø§Ø®ØªØ± Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹</h3>
                                        <div className="space-y-4">
                                            <div className={`p-4 border-2 rounded-xl cursor-pointer ${payment === 'vodafone' ? 'border-amber-400' : 'border-white/10'}`} onClick={() => setPayment('vodafone')}>
                                                <div className="flex items-center gap-3">
                                                    <Icon name="smartphone" className="text-red-500" />
                                                    <div>
                                                        <p className="font-bold">ÙÙˆØ¯Ø§ÙÙˆÙ† ÙƒØ§Ø´</p>
                                                        <p className="text-xs text-slate-400">Ø­ÙˆÙ„ Ø¹Ù„Ù‰: {CONTACT.vodafone}</p>
                                                    </div>
                                                </div>
                                            </div>

                                            <div className={`p-4 border-2 rounded-xl cursor-pointer ${payment === 'fawry' ? 'border-amber-400' : 'border-white/10'}`} onClick={() => setPayment('fawry')}>
                                                <div className="flex items-center gap-3">
                                                    <Icon name="credit-card" className="text-orange-500" />
                                                    <div>
                                                        <p className="font-bold">ÙÙˆØ±ÙŠ</p>
                                                        <p className="text-xs text-slate-400">Ø§Ø¯ÙØ¹ Ù…Ù† Ø£ÙŠ Ù…Ø§ÙƒÙŠÙ†Ø©</p>
                                                    </div>
                                                </div>
                                            </div>

                                            {payment === 'fawry' && (
                                                <div className="bg-white/5 p-4 rounded-xl">
                                                    <p className="text-sm mb-2">ÙƒÙˆØ¯ ÙÙˆØ±ÙŠ:</p>
                                                    <div className="bg-black/30 p-3 rounded-lg text-center">
                                                        <p className="font-mono text-2xl font-bold text-amber-400">{CONTACT.fawry}</p>
                                                    </div>
                                                </div>
                                            )}

                                            <a href={`${CONTACT.support}?text=ØªÙ… Ø§Ù„Ø¯ÙØ¹ - ${selected.package.name} - ${user.code} - ${selected.package.price} Ø¬ - ${payment === 'fawry' ? 'ÙÙˆØ±ÙŠ' : 'ÙÙˆØ¯Ø§ÙÙˆÙ†'}%0A%0AØ£Ø±ÙÙ‚ ØµÙˆØ±Ø© Ø§Ù„Ø¯ÙØ¹`}
                                                target="_blank" className="flex items-center justify-center gap-2 bg-green-600 text-white py-3 rounded-xl font-bold hover:bg-green-700">
                                                <Icon name="message-circle" /> Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø«Ø¨Ø§Øª
                                            </a>

                                            <button onClick={() => setModal({ ...modal, payment: false })} className="w-full py-2 bg-white/10 rounded-xl">Ø¥Ù„ØºØ§Ø¡</button>
                                        </div>
                                    </div>
                                </div>
                            )}
                        </div>
                    </div>
                );
            }

            // ADMIN
            if (view === 'admin') {
                return (
                    <div className="min-h-screen bg-slate-900 p-6">
                        <div className="max-w-7xl mx-auto glass p-8">
                            <div className="flex justify-between items-center mb-8">
                                <h2 className="text-3xl font-black text-amber-400">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h2>
                                <button onClick={() => window.authMethods.signOut(window.auth)} className="px-4 py-2 bg-red-600 rounded-lg">Ø®Ø±ÙˆØ¬</button>
                            </div>

                            <div className="grid grid-cols-4 gap-6 mb-8">
                                <div className="bg-white/5 p-4 rounded-xl">
                                    <div className="text-slate-400 text-xs">Ø§Ù„Ø·Ù„Ø§Ø¨</div>
                                    <div className="text-2xl font-black">{data.students.length}</div>
                                </div>
                                <div className="bg-white/5 p-4 rounded-xl">
                                    <div className="text-slate-400 text-xs">Ø§Ù„Ø·Ù„Ø¨Ø§Øª</div>
                                    <div className="text-2xl font-black text-orange-400">{data.requests.length}</div>
                                </div>
                                <div className="bg-white/5 p-4 rounded-xl">
                                    <div className="text-slate-400 text-xs">Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª</div>
                                    <div className="text-2xl font-black text-green-400">{data.payments.filter(p => p.status === 'pending').length}</div>
                                </div>
                                <div className="bg-white/5 p-4 rounded-xl">
                                    <div className="text-slate-400 text-xs">Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª</div>
                                    <div className="text-2xl font-black text-amber-400">{data.lectures.length}</div>
                                </div>
                            </div>

                            <div className="flex gap-2 mb-6 overflow-x-auto">
                                {['students', 'lectures', 'packages', 'exams', 'payments', 'qa', 'announcements'].map(t => (
                                    <button key={t} onClick={() => setTab(t)} className={`px-6 py-2 rounded-lg font-bold whitespace-nowrap ${tab === t ? 'bg-amber-400 text-slate-900' : 'bg-white/5'}`}>
                                        {t === 'students' ? 'Ø§Ù„Ø·Ù„Ø§Ø¨' : t === 'lectures' ? 'Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª' : t === 'packages' ? 'Ø§Ù„Ø¨Ø§Ù‚Ø§Øª' : t === 'exams' ? 'Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†Ø§Øª' : t === 'payments' ? 'Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª' : t === 'qa' ? 'Ø§Ù„Ø£Ø³Ø¦Ù„Ø©' : 'Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª'}
                                    </button>
                                ))}
                            </div>

                            {/* Students */}
                            {tab === 'students' && (
                                <div>
                                    {data.requests.length > 0 && (
                                        <div className="mb-6 bg-orange-500/10 p-4 rounded-xl">
                                            <h3 className="font-bold mb-3">Ø·Ù„Ø¨Ø§Øª Ø¬Ø¯ÙŠØ¯Ø© ({data.requests.length})</h3>
                                            {data.requests.map(r => (
                                                <div key={r.id} className="bg-black/20 p-3 rounded-lg mb-2 flex justify-between items-center">
                                                    <div>
                                                        <p className="font-bold">{r.name}</p>
                                                        <p className="text-xs text-slate-400">{r.phone} | {r.grade}</p>
                                                    </div>
                                                    <div className="flex gap-2">
                                                        <button onClick={async () => {
                                                            await window.rtdb.set(window.rtdb.ref(window.db, 'users/' + r.uid), { ...r, role: 'student', status: 'active', isPaid: false });
                                                            await window.rtdb.remove(window.rtdb.ref(window.db, 'requests/' + r.id));
                                                            show(`ØªÙ… Ù‚Ø¨ÙˆÙ„ ${r.name} - ÙƒÙˆØ¯: ${r.code}`);
                                                        }} className="bg-green-600 px-3 py-1 rounded text-sm">Ù‚Ø¨ÙˆÙ„</button>
                                                        <button onClick={() => window.rtdb.remove(window.rtdb.ref(window.db, 'requests/' + r.id))} className="bg-red-600 px-3 py-1 rounded text-sm">Ø±ÙØ¶</button>
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    )}

                                    <input className="w-full mb-4 bg-black/30 border border-white/10 p-3 rounded-xl" placeholder="Ø¨Ø­Ø«..." value={search} onChange={e => setSearch(e.target.value)} />

                                    <div className="space-y-2">
                                        {data.students.filter(s => s.name?.toLowerCase().includes(search.toLowerCase())).map(s => (
                                            <div key={s.id} className="bg-white/5 p-4 rounded-xl flex justify-between items-center">
                                                <div>
                                                    <p className="font-bold">{s.name}</p>
                                                    <p className="text-xs text-slate-400">{s.code} | {s.phone}</p>
                                                </div>
                                                <div className="flex gap-2">
                                                    <button onClick={() => { setSelected({ ...selected, student: s }); setModal({ ...modal, student: true }); }} className="bg-blue-500/20 px-3 py-1 rounded text-sm">Ø¥Ø¯Ø§Ø±Ø©</button>
                                                    <button onClick={() => update(s.id, { isPaid: !s.isPaid })} className={`px-3 py-1 rounded text-sm ${s.isPaid ? 'bg-green-500/20' : 'bg-red-500/20'}`}>
                                                        {s.isPaid ? 'Ù…ÙØ¹Ù„' : 'ØºÙŠØ± Ù…ÙØ¹Ù„'}
                                                    </button>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            )}

                            {/* Packages */}
                            {tab === 'packages' && (
                                <div>
                                    <div className="bg-black/20 p-6 rounded-xl mb-6">
                                        <h3 className="font-bold mb-4">Ø¥Ø¶Ø§ÙØ© Ø¨Ø§Ù‚Ø©</h3>
                                        <div className="space-y-3">
                                            <input id="pN" className="w-full bg-white/5 border border-white/10 p-3 rounded-lg" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¨Ø§Ù‚Ø© *" />
                                            <div className="grid grid-cols-2 gap-3">
                                                <input id="pP" type="number" className="w-full bg-white/5 border border-white/10 p-3 rounded-lg" placeholder="Ø§Ù„Ø³Ø¹Ø± *" />
                                                <input id="pM" type="number" className="w-full bg-white/5 border border-white/10 p-3 rounded-lg" placeholder="Ø¹Ø¯Ø¯ Ø§Ù„Ø´Ù‡ÙˆØ± *" />
                                            </div>
                                            <textarea id="pF" className="w-full bg-white/5 border border-white/10 p-3 rounded-lg h-24" placeholder="Ø§Ù„Ù…Ù…ÙŠØ²Ø§Øª (ÙƒÙ„ Ù…ÙŠØ²Ø© ÙÙŠ Ø³Ø·Ø±)"></textarea>
                                            <select id="pT" className="w-full bg-white/5 border border-white/10 p-3 rounded-lg">
                                                <option value="subscription">Ø§Ø´ØªØ±Ø§Ùƒ Ø´Ù‡Ø±ÙŠ</option>
                                                <option value="book">ÙƒØªØ§Ø¨</option>
                                                <option value="course">ÙƒÙˆØ±Ø³</option>
                                            </select>
                                            <button onClick={() => {
                                                upload('packages', {
                                                    name: document.getElementById('pN').value,
                                                    price: document.getElementById('pP').value,
                                                    months: document.getElementById('pM').value,
                                                    features: document.getElementById('pF').value,
                                                    type: document.getElementById('pT').value
                                                });
                                                ['pN', 'pP', 'pM', 'pF'].forEach(id => document.getElementById(id).value = '');
                                            }} className="btn-gold w-full py-2 rounded-lg">Ø¥Ø¶Ø§ÙØ©</button>
                                        </div>
                                    </div>

                                    <div className="grid md:grid-cols-3 gap-4">
                                        {data.packages.map(pkg => (
                                            <div key={pkg.id} className="bg-white/5 p-4 rounded-lg">
                                                <h4 className="font-bold mb-2">{pkg.name}</h4>
                                                <p className="text-2xl font-bold text-amber-400 mb-2">{pkg.price} Ø¬</p>
                                                <p className="text-sm text-slate-400 mb-2">{pkg.months} Ø´Ù‡Ø± | {pkg.type}</p>
                                                <button onClick={() => window.rtdb.remove(window.rtdb.ref(window.db, 'packages/' + pkg.id))} className="text-red-400 text-sm">Ø­Ø°Ù</button>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            )}

                            {/* Exams */}
                            {tab === 'exams' && (
                                <div>
                                    <div className="bg-black/20 p-6 rounded-xl mb-6">
                                        <h3 className="font-bold mb-4">Ø¥Ø¶Ø§ÙØ© Ø§Ù…ØªØ­Ø§Ù† (3 Ù†Ù…Ø§Ø°Ø¬)</h3>
                                        <div className="space-y-3">
                                            <select id="eL" className="w-full bg-white/5 border border-white/10 p-3 rounded-lg">
                                                <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø©...</option>
                                                {data.lectures.map(l => <option key={l.id} value={l.id}>{l.title}</option>)}
                                            </select>
                                            <div className="bg-white/5 p-4 rounded-lg">
                                                <p className="text-sm mb-2">Ù†Ù…ÙˆØ°Ø¬ A:</p>
                                                <textarea id="eA" className="w-full bg-black/30 border border-white/10 p-3 rounded-lg h-24 font-mono text-xs" placeholder='[{"question":"Ø³1","type":"mcq","options":["Ø£","Ø¨","Ø¬","Ø¯"],"correct":0}]'></textarea>
                                            </div>
                                            <div className="bg-white/5 p-4 rounded-lg">
                                                <p className="text-sm mb-2">Ù†Ù…ÙˆØ°Ø¬ B:</p>
                                                <textarea id="eB" className="w-full bg-black/30 border border-white/10 p-3 rounded-lg h-24 font-mono text-xs" placeholder='[{"question":"Ø³1","type":"text"}]'></textarea>
                                            </div>
                                            <div className="bg-white/5 p-4 rounded-lg">
                                                <p className="text-sm mb-2">Ù†Ù…ÙˆØ°Ø¬ C:</p>
                                                <textarea id="eC" className="w-full bg-black/30 border border-white/10 p-3 rounded-lg h-24 font-mono text-xs" placeholder='[{"question":"Ø³1","type":"image"}]'></textarea>
                                            </div>
                                            <input id="eW" className="w-full bg-white/5 border border-white/10 p-3 rounded-lg" placeholder="Ø±Ù‚Ù… ÙˆØ§ØªØ³Ø§Ø¨ Ù„Ù„ØµÙˆØ±" defaultValue={CONTACT.support} />
                                            <button onClick={() => {
                                                try {
                                                    upload('exams', {
                                                        lectureId: document.getElementById('eL').value,
                                                        modelA: JSON.parse(document.getElementById('eA').value || '[]'),
                                                        modelB: JSON.parse(document.getElementById('eB').value || '[]'),
                                                        modelC: JSON.parse(document.getElementById('eC').value || '[]'),
                                                        whatsappNumber: document.getElementById('eW').value
                                                    });
                                                    ['eA', 'eB', 'eC'].forEach(id => document.getElementById(id).value = '');
                                                } catch (e) {
                                                    show('Ø®Ø·Ø£ ÙÙŠ JSON', 'error');
                                                }
                                            }} className="btn-gold w-full py-2 rounded-lg">Ø¥Ø¶Ø§ÙØ©</button>
                                        </div>
                                    </div>
                                </div>
                            )}

                            {/* Lectures */}
                            {tab === 'lectures' && (
                                <div>
                                    <div className="bg-black/20 p-6 rounded-xl mb-6">
                                        <h3 className="font-bold mb-4">Ø¥Ø¶Ø§ÙØ© Ù…Ø­Ø§Ø¶Ø±Ø©</h3>
                                        <div className="space-y-3">
                                            <input id="lT" className="w-full bg-white/5 border border-white/10 p-3 rounded-lg" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø© *" />
                                            <textarea id="lD" className="w-full bg-white/5 border border-white/10 p-3 rounded-lg h-20" placeholder="Ø§Ù„ÙˆØµÙ"></textarea>
                                            <div className="grid grid-cols-2 gap-3">
                                                <select id="lG" className="w-full bg-white/5 border border-white/10 p-3 rounded-lg">
                                                    <option value="all">Ø¬Ù…ÙŠØ¹ Ø§Ù„ØµÙÙˆÙ</option>
                                                    <option value="1sec">Ø£ÙˆÙ„ Ø«Ø§Ù†ÙˆÙŠ</option>
                                                    <option value="2sec">Ø«Ø§Ù†ÙŠ Ø«Ø§Ù†ÙˆÙŠ</option>
                                                    <option value="3sec">Ø«Ø§Ù„Ø« Ø«Ø§Ù†ÙˆÙŠ</option>
                                                </select>
                                                <div className="flex items-center gap-2">
                                                    <input type="checkbox" id="lF" className="w-5 h-5" />
                                                    <label htmlFor="lF" className="text-sm">Ù…Ø­ØªÙˆÙ‰ Ù…Ø¬Ø§Ù†ÙŠ</label>
                                                </div>
                                            </div>
                                            <input id="lL" className="w-full bg-white/5 border border-white/10 p-3 rounded-lg" placeholder="Ø±Ø§Ø¨Ø· Ø§Ù„ÙÙŠØ¯ÙŠÙˆ *" />
                                            <button onClick={() => {
                                                upload('lectures', {
                                                    title: document.getElementById('lT').value,
                                                    description: document.getElementById('lD').value,
                                                    grade: document.getElementById('lG').value,
                                                    link: document.getElementById('lL').value,
                                                    isFree: document.getElementById('lF').checked
                                                });
                                                ['lT', 'lD', 'lL'].forEach(id => document.getElementById(id).value = '');
                                                document.getElementById('lF').checked = false;
                                            }} className="btn-gold w-full py-2 rounded-lg">Ù†Ø´Ø±</button>
                                        </div>
                                    </div>

                                    <div className="space-y-2">
                                        {data.lectures.map(l => (
                                            <div key={l.id} className="bg-white/5 p-3 rounded-lg flex justify-between items-center">
                                                <span className="font-bold">{l.title}</span>
                                                <button onClick={() => window.rtdb.remove(window.rtdb.ref(window.db, 'lectures/' + l.id))} className="text-red-400">
                                                    <Icon name="trash-2" size={18} />
                                                </button>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            )}

                            {/* Payments */}
                            {tab === 'payments' && (
                                <div>
                                    {data.payments.filter(p => p.status === 'pending').map(p => (
                                        <div key={p.id} className="bg-white/5 p-4 rounded-lg mb-3 flex justify-between items-center">
                                            <div>
                                                <p className="font-bold">{p.studentName}</p>
                                                <p className="text-xs text-slate-400">Ø¨Ø§Ù‚Ø©: {p.packageName} | {p.price} Ø¬</p>
                                            </div>
                                            <div className="flex gap-2">
                                                <button onClick={async () => {
                                                    await activate(p.studentId, p.packageId);
                                                    await window.rtdb.update(window.rtdb.ref(window.db, 'payments/' + p.id), { status: 'approved' });
                                                    show('ØªÙ… Ø§Ù„ØªÙØ¹ÙŠÙ„');
                                                }} className="bg-green-600 px-3 py-1 rounded text-sm">Ù…ÙˆØ§ÙÙ‚Ø©</button>
                                                <button onClick={() => window.rtdb.update(window.rtdb.ref(window.db, 'payments/' + p.id), { status: 'rejected' })} className="bg-red-600 px-3 py-1 rounded text-sm">Ø±ÙØ¶</button>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            )}

                            {/* Q&A */}
                            {tab === 'qa' && (
                                <div>
                                    {data.qa.map(q => (
                                        <div key={q.id} className="bg-white/5 p-4 rounded-lg mb-3">
                                            <div className="flex justify-between items-start mb-2">
                                                <div>
                                                    <p className="font-bold">{q.studentName}</p>
                                                    <p className="text-xs text-slate-400">{q.studentCode} | {q.category || 'Ø¹Ø§Ù…'}</p>
                                                </div>
                                                <span className={`text-xs px-2 py-1 rounded ${q.reply ? 'bg-green-500/20 text-green-300' : 'bg-orange-500/20 text-orange-300'}`}>
                                                    {q.reply ? 'ØªÙ… Ø§Ù„Ø±Ø¯' : 'Ø¨Ø§Ù†ØªØ¸Ø§Ø±'}
                                                </span>
                                            </div>
                                            <p className="text-slate-300 mb-3">{q.question}</p>
                                            {!q.reply && (
                                                <button onClick={async () => {
                                                    const r = prompt("Ø§Ù„Ø±Ø¯:");
                                                    if (r) {
                                                        await window.rtdb.update(window.rtdb.ref(window.db, `qa/${q.id}`), {
                                                            reply: r,
                                                            replyDate: new Date().toLocaleDateString('ar-EG')
                                                        });
                                                        show('ØªÙ… Ø§Ù„Ø±Ø¯');
                                                    }
                                                }} className="bg-blue-600 px-3 py-1 rounded text-sm">Ø±Ø¯</button>
                                            )}
                                            {q.reply && <div className="bg-green-500/10 p-3 rounded-lg mt-2 text-sm">{q.reply}</div>}
                                        </div>
                                    ))}
                                </div>
                            )}

                            {/* Announcements */}
                            {tab === 'announcements' && (
                                <div>
                                    <div className="bg-black/20 p-6 rounded-xl mb-6">
                                        <h3 className="font-bold mb-4">Ø¥Ø¶Ø§ÙØ© Ø¥Ø¹Ù„Ø§Ù†</h3>
                                        <div className="space-y-3">
                                            <input id="aT" className="w-full bg-white/5 border border-white/10 p-3 rounded-lg" placeholder="Ø§Ù„Ø¹Ù†ÙˆØ§Ù†" />
                                            <textarea id="aC" className="w-full bg-white/5 border border-white/10 p-3 rounded-lg h-24" placeholder="Ø§Ù„Ù…Ø­ØªÙˆÙ‰"></textarea>
                                            <button onClick={() => {
                                                upload('announcements', {
                                                    title: document.getElementById('aT').value,
                                                    content: document.getElementById('aC').value
                                                });
                                                ['aT', 'aC'].forEach(id => document.getElementById(id).value = '');
                                            }} className="btn-gold w-full py-2 rounded-lg">Ù†Ø´Ø±</button>
                                        </div>
                                    </div>
                                </div>
                            )}

                            {/* Student Modal */}
                            {modal.student && selected.student && (
                                <div className="fixed inset-0 bg-black/80 flex items-center justify-center z-50" onClick={() => setModal({ ...modal, student: false })}>
                                    <div className="glass p-6 w-full max-w-lg" onClick={e => e.stopPropagation()}>
                                        <h3 className="text-xl font-bold mb-4">Ø¥Ø¯Ø§Ø±Ø©: {selected.student.name}</h3>
                                        <div className="space-y-4">
                                            <div>
                                                <label className="text-xs text-slate-400 mb-1 block">Ù…Ù„Ø§Ø­Ø¸Ø§Øª:</label>
                                                <textarea className="w-full bg-black/30 border border-white/10 rounded-lg p-2 text-white h-20"
                                                    value={selected.student.notes || ''}
                                                    onChange={e => setSelected({ ...selected, student: { ...selected.student, notes: e.target.value } })} />
                                            </div>
                                            <div className="grid grid-cols-2 gap-4">
                                                <div>
                                                    <label className="text-xs text-slate-400 mb-1 block">Ø¨Ø§Ù‚Ø©:</label>
                                                    <select id="aPkg" className="w-full bg-black/30 border border-white/10 rounded-lg p-2 text-white">
                                                        <option value="">Ø§Ø®ØªØ±...</option>
                                                        {data.packages.map(pkg => (
                                                            <option key={pkg.id} value={pkg.id}>{pkg.name} - {pkg.price} Ø¬</option>
                                                        ))}
                                                    </select>
                                                </div>
                                                <div className="flex items-end">
                                                    <button onClick={() => {
                                                        const pid = document.getElementById('aPkg').value;
                                                        if (pid) {
                                                            activate(selected.student.id, pid);
                                                            setModal({ ...modal, student: false });
                                                        }
                                                    }} className="btn-gold w-full py-2 rounded-lg">ØªÙØ¹ÙŠÙ„</button>
                                                </div>
                                            </div>
                                            <div className="flex gap-2 pt-4">
                                                <button onClick={() => {
                                                    update(selected.student.id, { notes: selected.student.notes });
                                                }} className="flex-1 bg-blue-600 py-2 rounded-lg">Ø­ÙØ¸</button>
                                                <button onClick={() => setModal({ ...modal, student: false })} className="px-4 py-2 bg-white/10 rounded-lg">Ø¥ØºÙ„Ø§Ù‚</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            )}
                        </div>
                    </div>
                );
            }

            // Loading
            if (view === 'loading') return (
                <div className="h-screen bg-slate-900 flex items-center justify-center">
                    <div className="text-center">
                        <div className="loader mx-auto mb-4"></div>
                        <p className="text-amber-400 font-bold">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</p>
                    </div>
                </div>
            );

            return (
                <>
                    {notify && (
                        <div className={`fixed top-5 left-1/2 -translate-x-1/2 px-6 py-3 rounded-xl shadow-2xl font-bold z-[100] text-white flex items-center gap-2 ${notify.type === 'error' ? 'bg-red-600' : 'bg-green-600'}`}>
                            <Icon name={notify.type === 'error' ? 'alert-circle' : 'check-circle'} />
                            {notify.msg}
                        </div>
                    )}
                </>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>

</html>